(()=>{"use strict";var e={310(e,t,a){a.r(t),a.d(t,{default:()=>_t});var s={};a.r(s),a.d(s,{API_URL:()=>f,default:()=>g});var r=a(981),l=a(8115),n=a(530),o=a(3929),c=a(8080),i=a(8315),d=a(6665),u=a(7109);const f={NODE_ENV:"production",PUBLIC_URL:"",APP_MANIFEST:{name:"Mechanic Setu",slug:"mechanic-setu",version:"1.0.6",orientation:"portrait",icon:"./assets/logo-optimized.png",scheme:"mechanicsetu",userInterfaceStyle:"automatic",newArchEnabled:!0,web:{},notification:{icon:"./assets/logo-optimized.png",color:"#10b981",androidMode:"default",androidCollapsedTitle:"Mechanic Setu"},extra:{eas:{projectId:"27756afd-dd20-446f-848e-203760ffef63"}},sdkVersion:"54.0.0",platforms:["ios","android","web"],androidStatusBar:{backgroundColor:"#ffffff"}},EXPO_DEBUG:!1,PLATFORM:"web",WDS_SOCKET_PATH:"/_expo/ws"}.EXPO_PUBLIC_API_URL||"https://mechanic-setu.onrender.com/api",m=u.default.create({baseURL:f,withCredentials:!0,xsrfCookieName:"csrftoken",xsrfHeaderName:"X-CSRFToken"});let h=!1,x=[];m.interceptors.request.use(async e=>(console.log(`[API Request] ${e.method?.toUpperCase()} ${e.url}`),e),e=>(console.error("[API Request Error]",e),Promise.reject(e))),m.interceptors.response.use(e=>(e.config.url.includes("Profile/UserHistory/")?console.log(`[API Response] ${e.status} ${e.config.url}`):console.log(`[API Response] ${e.status} ${e.config.url}`,e.data),e),async e=>{const t=e.config;console.warn(`[API Error] ${e.response?.status} ${t?.url}`,e.response?.data);const a=t?.url?.includes("/token/refresh/");if(401===e.response?.status&&!t?._retry&&!a){if(h)return new Promise(e=>{var a;a=()=>e(m(t)),x.push(a)});t._retry=!0,h=!0;try{return console.log("Attempting to refresh token..."),await u.default.post(`${BASE_URL}/core/token/refresh/`,{},{withCredentials:!0}),console.log("Token refresh successful."),h=!1,x.forEach(e=>e()),x=[],await i.setItemAsync("Logged","true"),m(t)}catch(s){return console.error("Token refresh failed:",s),h=!1,await i.setItemAsync("Logged","false"),await i.deleteItemAsync("otp_ctx"),Promise.reject(s)}}return Promise.reject(e)});const g=m;var b=a(5111);const y=(0,d.createContext)(),p=()=>(0,d.useContext)(y),w=({children:e})=>{const[t,a]=(0,d.useState)(null),[s,r]=(0,d.useState)(!0),[l,n]=(0,d.useState)(""),o=(0,d.useCallback)(async()=>{console.log("[AuthContext] checkAuth: Checking login status...");try{const e=await g.get("/Profile/UserProfile/");console.log("[AuthContext] checkAuth: User profile fetched:",e.data),a(e.data),await i.setItemAsync("Logged","true")}catch(e){console.log("[AuthContext] checkAuth: Not logged in or session expired:",e.message),a(null),await i.setItemAsync("Logged","false")}finally{r(!1)}},[]);(0,d.useEffect)(()=>{o()},[o]);const c=s?null:!!t;return(0,b.jsx)(y.Provider,{value:{user:t,loading:s,error:l,isAuthenticated:c,checkAuth:o,profile:t,login:async e=>{n(""),console.log(`[AuthContext] login called with: ${e}`);try{console.log("[AuthContext] Sending POST to /users/Login_SignUp/");const t=await g.post("/users/Login_SignUp/",{email:e});console.log("[AuthContext] Login API response:",t.data);t.data.key,t.data.id?.toString(),t.data.status;return t.data}catch(t){console.error("[AuthContext] Login failed:",t);const e=t.response?.data?.error||"Login failed. Please check your email or try again.";throw n(e),t}},googleLogin:async e=>{n(""),console.log("[AuthContext] googleLogin with token");try{const t=await g.post("/users/google/",{token:e});if(console.log("[AuthContext] Google login success:",t.data),"New User"===t.data.status)return{status:"New User"};await o()}catch(t){throw console.error("Google login error:",t),n(t.response?.data?.detail||"Google login failed on our server."),t}},verifyOtp:async(e,t,a,s)=>{n(""),console.log(`[AuthContext] verifyOtp: ${a}`);try{const r={key:e,id:t,otp:a};if(await g.post("/users/otp-verify/",r),await o(),"New User"===s)return{status:"New User"}}catch(r){console.error("[AuthContext] OTP verify failed:",r);throw n(r?.response?.data?.error||"Verification failed. Try again."),r}},resendOtp:async(e,t)=>{console.log("[AuthContext] Resending OTP...");try{const a=await g.post("/users/resend-otp/",{key:e,id:t});return console.log("[AuthContext] Resend success:",a.data),a.data}catch(a){throw console.error("[AuthContext] Resend failed:",a),a}},logout:async()=>{console.log("[AuthContext] Logging out...");try{await g.post("/users/logout/")}catch(e){console.error("[AuthContext] Logout failed on server:",e)}finally{a(null),await i.deleteItemAsync("Logged"),await i.deleteItemAsync("otp_ctx")}},setError:n},children:e})};var j=a(5324);const N=(0,d.createContext)(null),S=()=>(0,d.useContext)(N),_=[1e3,2e3,5e3,1e4,3e4],v=_.length-1,P=({children:e})=>{const{isAuthenticated:t,user:a}=p(),[r,l]=(0,d.useState)(null),[n,o]=(0,d.useState)(null),[c,i]=(0,d.useState)("disconnected"),[u,f]=(0,d.useState)(0),[m,h]=(0,d.useState)(0),x=(0,d.useRef)(null),y=(0,d.useRef)(j.default.currentState),w=(0,d.useRef)(null),S=(0,d.useRef)(null),P=(0,d.useRef)(0),k=(0,d.useRef)([]),T=(0,d.useRef)(!1),E=(0,d.useRef)(!1),C=(0,d.useRef)(null),A=(0,d.useRef)(null);(0,d.useEffect)(()=>(E.current=!0,()=>{E.current=!1}),[]);const D=(0,d.useCallback)(e=>{const t="string"===typeof e?e:JSON.stringify(e);if(!x.current||x.current.readyState!==WebSocket.OPEN)return k.current.push(t),E.current&&f(k.current.length),console.log("%c[WS-PROVIDER] Message queued (offline):","color: #FFA500;",t),console.log(`[WS-PROVIDER] Queue size: ${k.current.length}`),!1;try{return x.current.send(t),console.log("%c[WS-PROVIDER] Message sent:","color: #00CED1;",t),!0}catch(a){return console.error("[WS-PROVIDER] Error sending message:",a),k.current.push(t),E.current&&f(k.current.length),console.log("%c[WS-PROVIDER] Message queued (send failed):","color: #FFA500;",t),!1}},[]),O=(0,d.useCallback)(()=>{if(k.current.length>0&&x.current&&x.current.readyState===WebSocket.OPEN){console.log(`%c[WS-PROVIDER] Flushing ${k.current.length} queued messages...`,"color: #32CD32; font-weight: bold;");const e=[...k.current];k.current=[],E.current&&f(0),e.forEach((t,a)=>{try{x.current.send(t),console.log(`%c[WS-PROVIDER] Sent queued message ${a+1}/${e.length}:`,"color: #32CD32;",t)}catch(s){console.error(`[WS-PROVIDER] Failed to send queued message ${a+1}:`,s),k.current.push(t),E.current&&f(k.current.length)}})}},[]),R=(0,d.useCallback)(e=>{A.current=e,console.log("[WS-PROVIDER] Active job ID updated:",e)},[]),I=(0,d.useCallback)(()=>{if(!t||T.current)return;const e=_[Math.min(P.current,v)];console.log(`%c[WS-PROVIDER] Scheduling reconnect attempt ${P.current+1} in ${e}ms...`,"color: #FF6347;"),S.current=setTimeout(()=>{P.current+=1,E.current&&h(P.current),L()},e)},[t]),L=(0,d.useCallback)(async()=>{if(t)if(!x.current||x.current.readyState!==WebSocket.OPEN&&x.current.readyState!==WebSocket.CONNECTING){T.current=!0,i("connecting"),console.log(`%c[WS-PROVIDER] Starting connection for User: ${a?.email||"Unknown"} (Attempt: ${P.current+1})`,"color: #8A2BE2;");try{const e=(await g.get("/core/ws-token/")).data.ws_token;if(!e)throw new Error("Failed to get WebSocket token");let a=s.BASE_URL.replace(/^https?:\/\//,"").replace(/\/api\/?$/,"");const r=s.BASE_URL.startsWith("https")?"wss":"ws",n=`${r}://${a}/ws/job_notifications/?token=${e}`;console.log(`[WS-PROVIDER] Connecting to: ${n}`);const c=`${"wss"===r?"https":"http"}://${a}`;x.current=new WebSocket(n,null,{headers:{Origin:c}}),x.current.onopen=()=>{console.log("%c[WS-PROVIDER] ==> Connection successful!","color: #008000; font-weight: bold;"),E.current&&(i("connected"),l(x.current),T.current=!1,P.current=0,h(0),C.current&&clearInterval(C.current),C.current=setInterval(()=>{if(x.current&&x.current.readyState===WebSocket.OPEN)try{const e=JSON.stringify({type:"user_heartbeat",timestamp:Date.now(),job_id:A.current});x.current.send(e),console.log("%c[WS-PROVIDER] \ud83d\udc93 Heartbeat sent:","color: #3b82f6;",{job_id:A.current})}catch(e){console.error("[WS-PROVIDER] Failed to send heartbeat:",e)}},25e3),O())},x.current.onmessage=e=>{try{const t=JSON.parse(e.data);console.log("%c\u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557","color: #22c55e; font-weight: bold;"),console.log("%c\u2551  [WS-PROVIDER] \ud83d\udce8 MESSAGE RECEIVED","color: #22c55e; font-weight: bold;"),console.log("%c\u2560\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2563","color: #22c55e;"),console.log("%c\u2551  Type:","color: #22c55e;",t.type),console.log("%c\u2551  Request ID:","color: #22c55e;",t.request_id),console.log("%c\u2551  Job ID:","color: #22c55e;",t.job_id),console.log("%c\u2551  Timestamp:","color: #22c55e;",(new Date).toLocaleTimeString()),console.log("%c\u2551  Full Data:","color: #22c55e;",t),console.log("%c\u255a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255d","color: #22c55e; font-weight: bold;"),E.current&&o(t)}catch(t){console.warn("[WS-PROVIDER] Received non-JSON message:",e.data)}},x.current.onclose=e=>{console.warn(`[WS-PROVIDER] ==> Disconnected. Code: ${e.code}, Reason: ${e.reason}`),E.current&&(i("disconnected"),l(null)),T.current=!1,1e3!==e.code&&t&&I()},x.current.onerror=e=>{console.error("[WS-PROVIDER] ==> An error occurred:",e.message),E.current&&i("error")}}catch(e){console.error("[WS-PROVIDER] ==> Connection setup failed:",e),i("error"),T.current=!1,t&&I()}}else console.log("%c[WS-PROVIDER] WebSocket already connected or connecting.","color: #008000;");else console.log("%c[WS-PROVIDER] User not connected (No Auth). Skipping WS connection.","color: #ff4500;")},[t,a,O,I]);(0,d.useEffect)(()=>{t?L():(S.current&&(clearTimeout(S.current),S.current=null),P.current=0,E.current&&h(0),x.current&&(console.log("[WS-PROVIDER] User logged out. Closing WebSocket."),x.current.close(1e3,"User logged out"),x.current=null,E.current&&i("disconnected")),k.current.length>0&&(console.log(`[WS-PROVIDER] Clearing ${k.current.length} queued messages due to logout.`),k.current=[],E.current&&f(0)))},[t,L]),(0,d.useEffect)(()=>{if(t&&"connected"===c)return w.current&&clearInterval(w.current),w.current=setInterval(()=>{console.log("%c[WS-PROVIDER] Auto-reconnecting to refresh session (4 min check)...","color: #FF4500;"),x.current&&x.current.close(1e3,"Auto-refresh"),P.current=0,E.current&&h(0),setTimeout(()=>L(),500)},24e4),()=>clearInterval(w.current)},[t,c,L]),(0,d.useEffect)(()=>{const e=j.default.addEventListener("change",e=>{y.current.match(/inactive|background/)&&"active"===e&&(console.log("[WS-PROVIDER] App came to foreground. Reconnecting if needed..."),!t||x.current&&x.current.readyState!==WebSocket.CLOSED||(P.current=0,E.current&&h(0),L())),y.current=e});return()=>{e.remove()}},[t,L]),(0,d.useEffect)(()=>()=>{w.current&&clearInterval(w.current),S.current&&clearTimeout(S.current),C.current&&clearInterval(C.current),x.current&&(console.log("[WS-PROVIDER] Provider unmounting. Closing WebSocket."),x.current.close(1e3,"Provider unmounted"),x.current=null)},[]);const M=(0,d.useMemo)(()=>({socket:r,lastMessage:n,connectionStatus:c,sendMessage:D,queueSize:u,reconnectAttempt:m,setActiveJobId:R}),[r,n,c,D,u,m,R]);return(0,b.jsx)(N.Provider,{value:M,children:e})},k=(0,r.createNavigationContainerRef)();function T(e,t){if(k.isReady())try{k.navigate(e,t)}catch(a){console.warn("Navigation failed (navigate):",a)}}function E(e){if(k.isReady())try{k.reset({index:0,routes:[{name:e}]})}catch(t){console.warn("Navigation failed (resetRoot):",t)}}var C=a(1690),A=a(6283),D=a(5648),O=a(1171);const R=()=>{const e=(0,r.useNavigation)(),t=(0,r.useRoute)(),{requestId:a}=t.params||{},[s,l]=(0,d.useState)(""),[c,u]=(0,d.useState)(!1);return(0,b.jsx)(O.SafeAreaView,{className:"flex-1 bg-white",children:(0,b.jsxs)(o.default,{className:"px-6 pt-6",children:[(0,b.jsx)(A.default,{className:"text-2xl font-black text-gray-900 mb-2",children:"Cancel Service?"}),(0,b.jsx)(A.default,{className:"text-gray-500 mb-8",children:"Please tell us why you want to cancel the request."}),["Mechanic delayed","Found help elsewhere","Incorrect details","Other"].map(e=>(0,b.jsxs)(D.default,{onPress:()=>l(e),className:"flex-row items-center justify-between p-4 mb-3 rounded-2xl border "+(s===e?"bg-blue-50 border-blue-200":"bg-white border-gray-100"),children:[(0,b.jsx)(A.default,{className:"font-bold "+(s===e?"text-blue-600":"text-gray-700"),children:e}),(0,b.jsx)(o.default,{className:"w-5 h-5 rounded-full border-2 items-center justify-center "+(s===e?"border-blue-500":"border-gray-300"),children:s===e&&(0,b.jsx)(o.default,{className:"w-2.5 h-2.5 bg-blue-500 rounded-full"})})]},e)),(0,b.jsxs)(o.default,{className:"flex-row space-x-3 mt-8",children:[(0,b.jsx)(D.default,{onPress:()=>e.goBack(),className:"flex-1 py-4 bg-gray-100 rounded-2xl items-center",disabled:c,children:(0,b.jsx)(A.default,{className:"font-bold text-gray-700",children:"Go Back"})}),(0,b.jsx)(D.default,{onPress:async()=>{if(s){u(!0);try{await g.post(`jobs/CancelServiceRequest/${a}/`,{cancellation_reason:s}),await i.deleteItemAsync("mechanicAcceptedData"),await i.deleteItemAsync("punctureRequestFormData"),C.default.alert("Request Cancelled","Your service request has been cancelled.",[{text:"OK",onPress:()=>E("Main")}])}catch(e){console.error("Cancellation failed",e);const t=e.response?.data?.error||"Failed to cancel. Try again.";C.default.alert("Error",t)}finally{u(!1)}}else C.default.alert("Selection Required","Please select a reason.")},disabled:!s||c,className:"flex-1 py-4 rounded-2xl items-center flex-row justify-center "+(s?"bg-red-500":"bg-gray-200"),children:c?(0,b.jsx)(n.default,{color:"white"}):(0,b.jsx)(A.default,{className:"font-bold text-white",children:"Confirm"})})]})]})})};var I=a(1385),L=a(7869),M=a(893),F=a(801),z=a(6725),Y=a(484),V=a(1815),q=a(1015);const{width:$,height:B}=z.default.get("window"),U={code:"function ConnectionStatusJsx1(){const{translateX,width,withSpring}=this.__closure;if(translateX.value>width/2){translateX.value=withSpring(width-150,{damping:15});}else{translateX.value=withSpring(20,{damping:15});}}"},W={code:"function ConnectionStatusJsx2(event){const{translateX,context,translateY}=this.__closure;translateX.value=event.translationX+context.value.x;translateY.value=event.translationY+context.value.y;}"},X={code:"function ConnectionStatusJsx3(){const{context,translateX,translateY}=this.__closure;context.value={x:translateX.value,y:translateY.value};}"},H={code:"function ConnectionStatusJsx4(){const{translateX,translateY}=this.__closure;return{transform:[{translateX:translateX.value},{translateY:translateY.value}]};}"},G=()=>{const{connectionStatus:e}=S(),t=(0,c.useSharedValue)($-120),a=(0,c.useSharedValue)(B-220),s=(0,c.useSharedValue)({x:0,y:0}),r=q.Gesture.Pan().onStart(function({_worklet_15610157513094_init_data:e,context:t,translateX:a,translateY:s}){const r=function(){t.value={x:a.value,y:s.value}};return r.__closure={context:t,translateX:a,translateY:s},r.__workletHash=0xe3285e4b986,r.__initData=e,r}({_worklet_15610157513094_init_data:X,context:s,translateX:t,translateY:a})).onUpdate(function({_worklet_9115213298492_init_data:e,translateX:t,context:a,translateY:s}){const r=function(e){t.value=e.translationX+a.value.x,s.value=e.translationY+a.value.y};return r.__closure={translateX:t,context:a,translateY:s},r.__workletHash=9115213298492,r.__initData=e,r}({_worklet_9115213298492_init_data:W,translateX:t,context:s,translateY:a})).onEnd(function({_worklet_10093401242965_init_data:e,translateX:t,width:a,withSpring:s}){const r=function(){t.value>a/2?t.value=s(a-150,{damping:15}):t.value=s(20,{damping:15})};return r.__closure={translateX:t,width:a,withSpring:s},r.__workletHash=0x92e0d987d55,r.__initData=e,r}({_worklet_10093401242965_init_data:U,translateX:t,width:$,withSpring:c.withSpring})),l=(0,c.useAnimatedStyle)(function({_worklet_16971166143119_init_data:e,translateX:t,translateY:a}){const s=function(){return{transform:[{translateX:t.value},{translateY:a.value}]}};return s.__closure={translateX:t,translateY:a},s.__workletHash=0xf6f6854528f,s.__initData=e,s}({_worklet_16971166143119_init_data:H,translateX:t,translateY:a}));let n,i,d,u;switch(e){case"connected":n="wifi",i="Connected",d="text-green-600",u="bg-green-50 border-green-200";break;case"connecting":n="time",i="Connecting...",d="text-yellow-600",u="bg-yellow-50 border-yellow-200";break;default:n="wifi-outline",i="Disconnected",d="text-red-600",u="bg-red-50 border-red-200"}return(0,b.jsx)(q.GestureDetector,{gesture:r,children:(0,b.jsx)(c.default.View,{style:[{position:"absolute",zIndex:100},l],children:(0,b.jsxs)(o.default,{className:`flex-row items-center px-4 py-2 rounded-full border shadow-sm ${u}`,children:[(0,b.jsx)(I.default,{name:n,size:16,className:`mr-2 ${d}`,style:{marginRight:6},color:"connected"===e?"#16a34a":"connecting"===e?"#ca8a04":"#dc2626"}),(0,b.jsx)(A.default,{className:`text-xs font-bold ${d}`,children:i})]})})})};var J=a(8587),K=a(5675);const Z=["children","style","initialRegion","region","onRegionChange","onRegionChangeComplete","provider","showsUserLocation","followsUserLocation"],Q=["coordinate","title","description","onPress","children"],ee=["coordinates","strokeColor","strokeWidth"],te=e=>{let{children:t,style:a,initialRegion:s,region:r}=e;(0,J.default)(e,Z);const l=(0,d.useRef)(null),[n,c]=d.useState(!1),i=r||s||{latitude:28.6139,longitude:77.209,latitudeDelta:.0922,longitudeDelta:.0421};(0,d.useEffect)(()=>{if(window.google)c(!0),u();else{const e=document.createElement("script");e.src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB41DRUbKW4nM5UPKsNHEMhhPcSilNv3I",e.async=!0,e.defer=!0,e.onload=()=>{c(!0),u()},document.head.appendChild(e)}},[]);const u=()=>{if(l.current&&window.google){const e=new window.google.maps.Map(l.current,{center:{lat:i.latitude,lng:i.longitude},zoom:13,mapTypeControl:!1,streetViewControl:!1,fullscreenControl:!1});l.current.googleMap=e,t&&d.Children.forEach(t,t=>{t&&t.type===ae?f(e,t.props):t&&t.type===se&&m(e,t.props)})}},f=(e,t)=>{t.coordinate&&window.google&&new window.google.maps.Marker({position:{lat:t.coordinate.latitude,lng:t.coordinate.longitude},map:e,title:t.title||""})},m=(e,t)=>{if(t.coordinates&&window.google){const a=t.coordinates.map(e=>({lat:e.latitude,lng:e.longitude}));new window.google.maps.Polyline({path:a,map:e,strokeColor:t.strokeColor||"#000",strokeWeight:t.strokeWidth||2})}};return(0,d.useEffect)(()=>{n&&l.current?.googleMap&&u()},[t,n]),(0,b.jsxs)(o.default,{style:[re.container,a],children:[(0,b.jsx)("div",{ref:l,style:{width:"100%",height:"100%",minHeight:400}}),!n&&(0,b.jsx)(o.default,{style:re.loading,children:(0,b.jsx)(A.default,{children:"Loading map..."})})]})},ae=e=>{(0,J.default)(e,Q);return null},se=e=>{(0,J.default)(e,ee);return null},re=K.default.create({container:{flex:1,overflow:"hidden"},loading:{position:"absolute",top:0,left:0,right:0,bottom:0,justifyContent:"center",alignItems:"center",backgroundColor:"#f0f0f0"}});te.Marker=ae,te.Polyline=se;const le=te,ne="google";let oe=[],ce=0;const ie=async()=>{const e=Date.now();if(oe.length>0&&e-ce<9e5)return console.log("[AdsCache] Returning cached ads"),oe;try{console.log("[AdsCache] Fetching new ads from server");const t=await g.get("/core/map-ads/");if(Array.isArray(t.data))return oe=t.data,ce=e,oe}catch(t){if(console.log("Error fetching ads:",t),oe.length>0)return console.log("[AdsCache] Network failed, returning stale cache"),oe}return[]},{width:de,height:ue}=z.default.get("window"),fe={COLLAPSED:.75*ue,EXPANDED:.4*ue},me={code:"function DashboardScreenJsx1(){const{translateY,SNAP_POINTS,withTiming}=this.__closure;if(translateY.value<(SNAP_POINTS.COLLAPSED+SNAP_POINTS.EXPANDED)/2){translateY.value=withTiming(SNAP_POINTS.EXPANDED,{duration:300});}else{translateY.value=withTiming(SNAP_POINTS.COLLAPSED,{duration:300});}}"},he={code:"function DashboardScreenJsx2(event){const{translateY,context,SNAP_POINTS}=this.__closure;translateY.value=event.translationY+context.value.y;translateY.value=Math.max(translateY.value,SNAP_POINTS.EXPANDED-50);}"},xe={code:"function DashboardScreenJsx3(){const{context,translateY}=this.__closure;context.value={y:translateY.value};}"},ge={code:"function DashboardScreenJsx4(){const{translateY}=this.__closure;return{transform:[{translateY:translateY.value}]};}"},be=({navigation:e})=>{const{logout:t,profile:s}=p(),r=s||{},[l,n]=(0,d.useState)([]),[u,f]=(0,d.useState)([]),[m,h]=(0,d.useState)(null);(0,d.useEffect)(()=>{(async()=>{const e=await ie();f(e)})()},[]);const[x,y]=(0,d.useState)(null),w=(0,c.useSharedValue)(fe.COLLAPSED),j=(0,c.useSharedValue)({y:0});(0,d.useEffect)(()=>{const t=e.addListener("focus",()=>{S(),N()});return _(),S(),N(),t},[e]);const N=async()=>{try{const{status:e}=await F.requestForegroundPermissionsAsync();if("granted"!==e)return void console.log("Permission to access location was denied");const t=await F.getCurrentPositionAsync({});T({latitude:t.coords.latitude,longitude:t.coords.longitude,latitudeDelta:.005,longitudeDelta:.005})}catch(e){console.warn("Error getting location:",e)}},S=async()=>{try{const e=await i.getItemAsync("mechanicAcceptedData");if(e){const t=JSON.parse(e);console.log("Found active job:",t.request_id),y(t)}else y(null)}catch(e){console.error("Failed to check active job",e)}},_=async()=>{try{const e=await g.get("/Profile/UserHistory/"),t=e.data?.sort((e,t)=>new Date(t.created_at)-new Date(e.created_at))||[];n(t.slice(0,3))}catch(e){console.error("Dashboard history fetch error:",e)}},v=q.Gesture.Pan().onStart(function({_worklet_9157383813867_init_data:e,context:t,translateY:a}){const s=function(){t.value={y:a.value}};return s.__closure={context:t,translateY:a},s.__workletHash=9157383813867,s.__initData=e,s}({_worklet_9157383813867_init_data:xe,context:j,translateY:w})).onUpdate(function({_worklet_11081176886531_init_data:e,translateY:t,context:a,SNAP_POINTS:s}){const r=function(e){t.value=e.translationY+a.value.y,t.value=Math.max(t.value,s.EXPANDED-50)};return r.__closure={translateY:t,context:a,SNAP_POINTS:s},r.__workletHash=0xa14099cad03,r.__initData=e,r}({_worklet_11081176886531_init_data:he,translateY:w,context:j,SNAP_POINTS:fe})).onEnd(function({_worklet_11954976620967_init_data:e,translateY:t,SNAP_POINTS:a,withTiming:s}){const r=function(){t.value<(a.COLLAPSED+a.EXPANDED)/2?t.value=s(a.EXPANDED,{duration:300}):t.value=s(a.COLLAPSED,{duration:300})};return r.__closure={translateY:t,SNAP_POINTS:a,withTiming:s},r.__workletHash=0xadf7c2281a7,r.__initData=e,r}({_worklet_11954976620967_init_data:me,translateY:w,SNAP_POINTS:fe,withTiming:c.withTiming})),P=(0,c.useAnimatedStyle)(function({_worklet_9139103797986_init_data:e,translateY:t}){const a=function(){return{transform:[{translateY:t.value}]}};return a.__closure={translateY:t},a.__workletHash=9139103797986,a.__initData=e,a}({_worklet_9139103797986_init_data:ge,translateY:w})),[k,T]=(0,d.useState)({latitude:23.0225,longitude:72.5714,latitudeDelta:.1,longitudeDelta:.1});return(0,b.jsx)(q.GestureHandlerRootView,{style:{flex:1},children:(0,b.jsxs)(o.default,{className:"flex-1 bg-white",children:[(0,b.jsx)(V.default,{barStyle:"dark-content"}),(0,b.jsx)(o.default,{className:"absolute top-0 left-0 right-0 z-10",children:(0,b.jsx)(O.SafeAreaView,{className:"bg-white/90 shadow-sm border-b border-gray-200",children:(0,b.jsxs)(o.default,{className:"px-4 py-3 flex-row items-center justify-between",children:[(0,b.jsxs)(o.default,{className:"flex-row items-center",children:[(0,b.jsx)(Y.default,{source:a(4082),className:"w-10 h-10",resizeMode:"contain"}),(0,b.jsx)(A.default,{className:"text-xl font-bold text-gray-900 tracking-wide ml-2",children:"Mechanic Setu"})]}),(0,b.jsx)(D.default,{onPress:()=>e.navigate("Settings"),className:"p-2 bg-gray-100 rounded-full",children:(0,b.jsx)(I.default,{name:"settings-outline",size:24,color:"#374151"})})]})})}),(0,b.jsx)(le,{provider:ne,style:{flex:1,width:"100%",height:"100%"},region:k,customMapStyle:[{elementType:"geometry",stylers:[{color:"#f5f7fa"}]},{elementType:"labels.icon",stylers:[{visibility:"off"}]},{elementType:"labels.text.fill",stylers:[{color:"#4a5568"}]},{elementType:"labels.text.stroke",stylers:[{color:"#f5f7fa"}]},{featureType:"administrative",elementType:"geometry.stroke",stylers:[{color:"#cbd5e0"}]},{featureType:"administrative.land_parcel",stylers:[{visibility:"off"}]},{featureType:"poi",stylers:[{visibility:"off"}]},{featureType:"poi.park",stylers:[{visibility:"on"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#e6f4ea"}]},{featureType:"poi.park",elementType:"geometry.fill",stylers:[{color:"#b7e6c6"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#ffffff"}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{color:"#e2e8f0",weight:1}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{color:"#edf2f7"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#e2e8f0"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#cbd5e0",weight:1.5}]},{featureType:"road.local",elementType:"labels.text.fill",stylers:[{color:"#a0aec0"}]},{featureType:"transit",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#4299e1"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#2d3748"}]},{featureType:"landscape.natural",elementType:"geometry",stylers:[{color:"#e6f4ea"}]},{featureType:"landscape.natural.landcover",elementType:"geometry",stylers:[{color:"#c6f6d5"}]},{featureType:"landscape.natural.terrain",elementType:"geometry",stylers:[{color:"#d4edda"}]}],showsUserLocation:!0,showsMyLocationButton:!1,children:u.map(e=>(0,b.jsx)(ae,{coordinate:{latitude:e.latitude,longitude:e.longitude},onPress:()=>h(e),children:(0,b.jsx)(o.default,{className:"bg-white p-0.5 rounded-full border-2 border-amber-400 shadow-lg overflow-hidden",style:{width:36,height:36},children:(0,b.jsx)(Y.default,{source:{uri:e.logo},className:"w-full h-full rounded-full",resizeMode:"cover"})})},`ad-${e.id}`))}),(0,b.jsx)(G,{}),(0,b.jsx)(q.GestureDetector,{gesture:v,children:(0,b.jsxs)(c.default.View,{style:[{position:"absolute",left:0,right:0,height:ue,top:0,backgroundColor:"white",borderTopLeftRadius:30,borderTopRightRadius:30,shadowColor:"#000",shadowOffset:{width:0,height:-3},shadowOpacity:.1,shadowRadius:5,elevation:10,paddingTop:10},P],children:[(0,b.jsx)(o.default,{className:"w-12 h-1.5 bg-gray-300 rounded-full self-center mb-2"}),(0,b.jsxs)(o.default,{className:"px-6 pb-20",children:[(0,b.jsxs)(D.default,{onPress:()=>e.navigate("Profile"),className:"flex-row items-center bg-gray-50 p-4 rounded-2xl mb-6 border border-gray-100",children:[r.profile_pic?(0,b.jsx)(Y.default,{source:{uri:r.profile_pic},className:"w-12 h-12 rounded-full mr-4"}):(0,b.jsx)(o.default,{className:"w-12 h-12 rounded-full bg-blue-100 items-center justify-center mr-4",children:(0,b.jsx)(A.default,{className:"text-xl font-bold text-blue-600",children:r.first_name?r.first_name[0]:"U"})}),(0,b.jsxs)(o.default,{className:"flex-1",children:[(0,b.jsx)(A.default,{className:"text-lg font-bold text-gray-900",children:r.first_name?`${r.first_name} ${r.last_name||""}`:"Welcome User"}),(0,b.jsx)(A.default,{className:"text-sm text-gray-500",children:r.email||"No Email"})]}),(0,b.jsx)(o.default,{className:"bg-gray-200 p-2 rounded-full",children:(0,b.jsx)(I.default,{name:"arrow-forward",size:20,color:"#4b5563"})})]}),x?(0,b.jsxs)(D.default,{className:"w-full p-4 rounded-xl bg-green-500 shadow-lg shadow-green-500/30 active:scale-95 transition-transform mb-8 items-center flex-row justify-between",onPress:()=>{x&&e.navigate("MechanicFound",{data:{mechanic_details:x.mechanic,job_id:x.request_id},userLocation:x.user_location})},children:[(0,b.jsxs)(o.default,{children:[(0,b.jsx)(A.default,{className:"text-white font-bold text-lg",children:"Active Service"}),(0,b.jsxs)(A.default,{className:"text-green-100 text-sm",children:["Mechanic ",x.mechanic?.first_name," is active"]})]}),(0,b.jsx)(o.default,{className:"bg-white/20 p-2 rounded-full",children:(0,b.jsx)(I.default,{name:"navigate-circle",size:32,color:"white"})})]}):(0,b.jsxs)(D.default,{className:"w-full py-4 rounded-xl bg-blue-500 shadow-lg shadow-blue-500/30 active:scale-95 transition-transform mb-8",onPress:()=>e.navigate("ServiceRequest"),children:[(0,b.jsx)(M.LinearGradient,{colors:["#3b82f6","#2563eb"],className:"absolute inset-0 rounded-xl"}),(0,b.jsx)(A.default,{className:"text-white text-center font-bold text-lg tracking-wide",children:"Request Now"})]}),(0,b.jsxs)(o.default,{className:"mb-4",children:[(0,b.jsx)(A.default,{className:"text-lg font-bold text-gray-900 mb-4",children:"Recent Activity"}),l.length>0?l.map(e=>(0,b.jsxs)(o.default,{className:"flex-row items-center justify-between p-4 bg-gray-50 rounded-xl mb-3 border border-gray-100",children:[(0,b.jsxs)(o.default,{className:"flex-row items-center space-x-3",children:[(0,b.jsx)(o.default,{className:"p-2 rounded-full "+("COMPLETED"===e.status?"bg-green-100":"bg-gray-200"),children:"car"===e.vehical_type?(0,b.jsx)(I.default,{name:"car-sport",size:18,color:"COMPLETED"===e.status?"#16a34a":"#6b7280"}):(0,b.jsx)(L.default,{name:"motorbike",size:18,color:"COMPLETED"===e.status?"#16a34a":"#6b7280"})}),(0,b.jsxs)(o.default,{children:[(0,b.jsx)(A.default,{className:"text-gray-900 font-bold",children:e.problem}),(0,b.jsx)(A.default,{className:"text-xs text-gray-500",children:new Date(e.created_at).toLocaleDateString()})]})]}),(0,b.jsx)(A.default,{className:"text-xs font-bold "+("COMPLETED"===e.status?"text-green-600":"CANCELLED"===e.status?"text-red-500":"text-gray-500"),children:e.status})]},e.id)):(0,b.jsx)(A.default,{className:"text-gray-400 text-center italic",children:"No recent activity."})]})]})]})})]})})};var ye=a(932);const{width:pe}=z.default.get("window"),we=({item:e})=>(0,b.jsxs)(D.default,{className:"rounded-3xl shadow-lg overflow-hidden mb-4 relative",style:{width:"100%",backgroundColor:e.bgColor},children:[(0,b.jsxs)(o.default,{className:"absolute top-3 left-3 bg-white/90 px-3 py-1 rounded-full z-10 flex-row items-center",children:[(0,b.jsx)(o.default,{className:"w-1.5 h-1.5 bg-blue-500 rounded-full mr-1.5"}),(0,b.jsx)(A.default,{className:"text-gray-600 font-bold text-xs",children:"Ad"})]}),e.badge&&(0,b.jsx)(o.default,{className:"absolute top-3 right-3 px-3 py-1.5 rounded-full z-10",style:{backgroundColor:e.accentColor},children:(0,b.jsx)(A.default,{className:"text-white font-black text-xs uppercase tracking-wider",children:e.badge})}),(0,b.jsxs)(o.default,{className:"p-5",children:[(0,b.jsx)(o.default,{className:"items-center justify-center mb-4 mt-4",children:(0,b.jsx)(Y.default,{source:{uri:e.image},style:{width:120,height:120},resizeMode:"contain"})}),(0,b.jsxs)(o.default,{className:"mb-4",children:[(0,b.jsx)(A.default,{className:"font-black text-xl mb-1",style:{color:e.accentColor},children:e.title}),(0,b.jsx)(A.default,{className:"text-gray-700 font-bold text-base mb-2",children:e.subtitle}),(0,b.jsx)(A.default,{className:"text-gray-600 text-sm leading-5",numberOfLines:2,children:e.description})]}),(0,b.jsxs)(D.default,{className:"py-3 px-6 rounded-xl flex-row items-center justify-center",style:{backgroundColor:e.accentColor},children:[(0,b.jsx)(A.default,{className:"text-white font-bold text-sm mr-2",children:e.ctaText}),(0,b.jsx)(I.default,{name:"arrow-forward",size:16,color:"white"})]})]})]}),{width:je,height:Ne}=z.default.get("window"),Se={COLLAPSED:.65*Ne,EXPANDED:.35*Ne},_e=[{elementType:"geometry",stylers:[{color:"#f5f5f5"}]},{elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#ffffff"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#e9e9e9"}]}],ve={code:"function FindingMechanicScreenJsx1(){const{translateY,SNAP_POINTS,withTiming}=this.__closure;if(translateY.value<(SNAP_POINTS.COLLAPSED+SNAP_POINTS.EXPANDED)/2){translateY.value=withTiming(SNAP_POINTS.EXPANDED,{duration:300});}else{translateY.value=withTiming(SNAP_POINTS.COLLAPSED,{duration:300});}}"},Pe={code:"function FindingMechanicScreenJsx2(event){const{translateY,context,SNAP_POINTS}=this.__closure;translateY.value=event.translationY+context.value.y;translateY.value=Math.max(SNAP_POINTS.EXPANDED,Math.min(translateY.value,SNAP_POINTS.COLLAPSED+50));}"},ke={code:"function FindingMechanicScreenJsx3(){const{context,translateY}=this.__closure;context.value={y:translateY.value};}"},Te={code:"function FindingMechanicScreenJsx4(){const{translateY,height}=this.__closure;return{transform:[{translateY:translateY.value}],height:height,top:0,marginBottom:16};}"},Ee={code:"function FindingMechanicScreenJsx5(){const{scanX}=this.__closure;return{transform:[{translateX:scanX.value}]};}"},Ce=K.default.create({pulseRing:{position:"absolute",width:60,height:60,borderRadius:30,backgroundColor:"#3b82f6",borderWidth:1,borderColor:"#3b82f6"},bottomSheet:{position:"absolute",left:0,right:0,height:Ne,top:0,backgroundColor:"white",borderTopLeftRadius:32,borderTopRightRadius:32,shadowColor:"#000",shadowOffset:{width:0,height:-10},shadowOpacity:.1,shadowRadius:20,elevation:25},scanLine:{height:"100%",width:"40%",backgroundColor:"#3b82f6"}}),Ae=()=>{const e=(0,r.useNavigation)(),t=(0,r.useIsFocused)(),{profile:a}=p(),s=(0,r.useRoute)(),l=(0,d.useRef)(null),{requestId:n,latitude:u,longitude:f,vehicleType:m,problem:h}=s.params||{},[x,g]=(0,d.useState)(null),y=a||{},[w,j]=(0,d.useState)([]),[N,_]=(0,d.useState)(null),v=(0,d.useRef)(!0);(0,d.useEffect)(()=>(v.current=!0,()=>{v.current=!1}),[]),(0,d.useEffect)(()=>{(async()=>{const e=await ie();j(e)})()},[]);const P=(0,d.useMemo)(()=>({latitude:u||23.0225,longitude:f||72.5714}),[u,f]);(0,d.useEffect)(()=>{(async()=>{try{const e=await i.getItemAsync("punctureRequestFormData");if(e){const t=JSON.parse(e);g(Object.assign({},t,{id:n||t.id}))}else n&&g({vehicleType:m,problem:h,id:n})}catch(e){console.error("Failed to load form data",e)}})()},[n]);const{socket:k,lastMessage:R}=S();(0,d.useEffect)(()=>{if(!v.current||!R||!t)return;console.log("[FindingMechanic] New Message:",R);const{type:e,service_request:a,message:s,job_id:r}=R;if("new_job"===e&&a)a.id===parseInt(n)&&(console.log("[FindingMechanic] Server confirmed job is live."),v.current&&g({vehicleType:a.vehical_type,problem:a.problem,location:a.location,id:a.id}),"function"===typeof startFakeMechanicSimulation&&startFakeMechanicSimulation());else if("mechanic_accepted"===R.type)T("MechanicFound",{data:R,userLocation:{latitude:u,longitude:f},vehicleType:x?.vehicleType||m,problem:x?.problem||h});else if("no_mechanic_found"===e){const e=r||a?.id;if(e&&String(e)!==String(n))return;T("NearbyMechanics",{jobDetails:x||{vehicleType:m,problem:h},userLocation:{latitude:u,longitude:f}})}else if("job_expired"===e){const e="Request Expired",t=s||"Please try again later.";C.default.alert(e,t,[{text:"Try Again",onPress:()=>E("Main")}],{cancelable:!1})}},[R,t]);const L=(0,c.useSharedValue)(0),[M,F]=(0,d.useState)("0:00");(0,d.useEffect)(()=>{const e=setInterval(()=>{L.value+=1;const e=Math.floor(L.value/60),t=L.value%60;F(`${e}:${t.toString().padStart(2,"0")}`)},1e3);return()=>clearInterval(e)},[]);const z=(0,c.useSharedValue)(Se.COLLAPSED),V=(0,c.useSharedValue)({y:0}),$=(0,c.useSharedValue)(-je);(0,d.useEffect)(()=>{$.value=(0,c.withRepeat)((0,c.withTiming)(je,{duration:2e3}),-1,!1)},[]);const B=(0,d.useMemo)(()=>[{id:"1",type:"image",title:"Flat 20% OFF",subtitle:"on Premium Car Servicing",description:"Book comprehensive car service at your doorstep",bgColor:"#EEF2FF",accentColor:"#4F46E5",image:"https://cdn-icons-png.flaticon.com/512/3097/3097136.png",ctaText:"Book Service",badge:"LIMITED OFFER"},{id:"2",type:"image",title:"Roadside Assistance",subtitle:"24/7 Emergency Support",description:"Get instant help anywhere, anytime",bgColor:"#FEF3C7",accentColor:"#F59E0B",image:"https://cdn-icons-png.flaticon.com/512/2917/2917995.png",ctaText:"Subscribe Now",badge:"\u20b999/Year"},{id:"3",type:"image",title:"Castrol Engine Oil",subtitle:"Magnatec Protection",description:"Premium engine oil with 75% less engine wear",bgColor:"#D1FAE5",accentColor:"#059669",image:"https://cdn-icons-png.flaticon.com/512/2917/2917242.png",ctaText:"Shop Now",badge:"From \u20b9499"},{id:"4",type:"image",title:"Tyre Replacement",subtitle:"Top Brands Available",description:"Get the best deals on premium tyres",bgColor:"#FEE2E2",accentColor:"#DC2626",image:"https://cdn-icons-png.flaticon.com/512/3097/3097039.png",ctaText:"View Offers",badge:"Save Big"},{id:"5",type:"image",title:"Battery Check",subtitle:"Free Inspection",description:"Avoid unexpected breakdowns with battery testing",bgColor:"#DBEAFE",accentColor:"#2563EB",image:"https://cdn-icons-png.flaticon.com/512/2917/2917439.png",ctaText:"Book Now",badge:"FREE"}],[]),U=q.Gesture.Pan().onStart(function({_worklet_16116884979916_init_data:e,context:t,translateY:a}){const s=function(){t.value={y:a.value}};return s.__closure={context:t,translateY:a},s.__workletHash=0xea8813440cc,s.__initData=e,s}({_worklet_16116884979916_init_data:ke,context:V,translateY:z})).onUpdate(function({_worklet_8614316172246_init_data:e,translateY:t,context:a,SNAP_POINTS:s}){const r=function(e){t.value=e.translationY+a.value.y,t.value=Math.max(s.EXPANDED,Math.min(t.value,s.COLLAPSED+50))};return r.__closure={translateY:t,context:a,SNAP_POINTS:s},r.__workletHash=8614316172246,r.__initData=e,r}({_worklet_8614316172246_init_data:Pe,translateY:z,context:V,SNAP_POINTS:Se})).onEnd(function({_worklet_7176147622784_init_data:e,translateY:t,SNAP_POINTS:a,withTiming:s}){const r=function(){t.value<(a.COLLAPSED+a.EXPANDED)/2?t.value=s(a.EXPANDED,{duration:300}):t.value=s(a.COLLAPSED,{duration:300})};return r.__closure={translateY:t,SNAP_POINTS:a,withTiming:s},r.__workletHash=7176147622784,r.__initData=e,r}({_worklet_7176147622784_init_data:ve,translateY:z,SNAP_POINTS:Se,withTiming:c.withTiming})),W=(0,c.useAnimatedStyle)(function({_worklet_10157085414381_init_data:e,translateY:t,height:a}){const s=function(){return{transform:[{translateY:t.value}],height:a,top:0,marginBottom:16}};return s.__closure={translateY:t,height:a},s.__workletHash=0x93ce177d3ed,s.__initData=e,s}({_worklet_10157085414381_init_data:Te,translateY:z,height:Ne})),X=(0,c.useAnimatedStyle)(function({_worklet_8466279230693_init_data:e,scanX:t}){const a=()=>({transform:[{translateX:t.value}]});return a.__closure={scanX:t},a.__workletHash=8466279230693,a.__initData=e,a}({_worklet_8466279230693_init_data:Ee,scanX:$}));return(0,b.jsx)(q.GestureHandlerRootView,{style:{flex:1},children:(0,b.jsxs)(o.default,{className:"flex-1 bg-white",children:[(0,b.jsxs)(le,{ref:l,provider:ne,style:{flex:1},customMapStyle:_e,initialRegion:Object.assign({},P,{latitudeDelta:.005,longitudeDelta:.005}),moveOnMarkerPress:!1,toolbarEnabled:!1,loadingEnabled:!1,children:[(0,b.jsx)(ae,{coordinate:P,flat:!0,anchor:{x:.5,y:.5},tracksViewChanges:!1,onPress:()=>{l.current&&l.current.animateToRegion(Object.assign({},P,{latitudeDelta:.005,longitudeDelta:.005}),2e3)},children:(0,b.jsxs)(o.default,{className:"items-center justify-center",children:[(0,b.jsx)(o.default,{className:"w-10 h-10 bg-black rounded-full border-[3px] border-white shadow-2xl items-center justify-center",children:(0,b.jsx)(I.default,{name:"location",size:18,color:"white"})}),(0,b.jsxs)(A.default,{children:[y.first_name," \ud83d\ude4b\u200d\u2642\ufe0f"]})]})}),(0,d.useMemo)(()=>w.map(e=>(0,b.jsx)(ae,{coordinate:{latitude:e.latitude,longitude:e.longitude},onPress:()=>_(e),tracksViewChanges:!1,children:(0,b.jsx)(o.default,{className:"bg-white p-0.5 rounded-full border-2 border-amber-400 shadow-lg overflow-hidden",style:{width:36,height:36},children:(0,b.jsx)(Y.default,{source:{uri:e.logo},className:"w-full h-full rounded-full",resizeMode:"cover"})})},`ad-${e.id}`)),[w])]}),(0,b.jsx)(O.SafeAreaView,{className:"absolute top-4 left-4 z-20",children:(0,b.jsx)(D.default,{onPress:()=>e.goBack(),className:"bg-white w-10 h-10 rounded-full shadow-lg items-center justify-center border border-gray-100",children:(0,b.jsx)(I.default,{name:"close",size:24,color:"black"})})}),(0,b.jsx)(q.GestureDetector,{gesture:U,children:(0,b.jsxs)(c.default.View,{style:[{position:"absolute",left:0,right:0,backgroundColor:"white",borderTopLeftRadius:30,borderTopRightRadius:30,elevation:10,paddingTop:10,marginBottom:3},W],children:[(0,b.jsx)(o.default,{className:"w-12 h-1.5 bg-gray-300 rounded-full self-center mb-2"}),(0,b.jsx)(o.default,{className:"h-2 w-full bg-blue-100 rounded-full overflow-hidden",children:(0,b.jsx)(c.default.View,{style:[Ce.scanLine,X]})}),(0,b.jsx)(q.ScrollView,{children:(0,b.jsxs)(o.default,{className:"pt-6 px-6 pb-10 mb-52",children:[(0,b.jsxs)(o.default,{className:"flex gap-4 mb-6",children:[(0,b.jsxs)(o.default,{children:[(0,b.jsx)(A.default,{className:"text-2xl font-extrabold text-gray-900 tracking-tight",children:x?.id?"Job is Live!":"Broadcasting..."}),(0,b.jsx)(A.default,{className:"text-gray-500 text-sm mt-1",children:x?.id?`Your request (ID: ${x.id}) is now visible to nearby mechanics.`:"Sending your request to the server..."}),x?.location&&(0,b.jsxs)(o.default,{className:"flex-row items-center bg-gray-50 p-3 rounded-xl mt-4",children:[(0,b.jsx)(I.default,{name:"location",size:16,color:"#3b82f6"}),(0,b.jsx)(A.default,{className:"ml-2 text-gray-600 text-xs flex-1",numberOfLines:1,children:x.location})]})]}),(0,b.jsxs)(o.default,{className:"flex-row items-center bg-blue-50 self-start px-3 py-1.5 rounded-full border border-blue-100",children:[(0,b.jsx)(I.default,{name:"time",size:14,color:"#2563eb"}),(0,b.jsxs)(A.default,{className:"ml-2 text-blue-600 font-semibold text-xs",children:["Elapsed: ",M]})]})]}),(0,b.jsxs)(o.default,{className:"mb-8",children:[(0,b.jsx)(A.default,{className:"text-xs font-bold text-gray-400 uppercase tracking-widest mb-3",children:"Recommended for you"}),(0,b.jsx)(ye.default,{data:B,renderItem:({item:e})=>(0,b.jsx)(we,{item:e}),scrollEnabled:!1,keyExtractor:e=>e.id})]}),(0,b.jsxs)(D.default,{onPress:()=>e.navigate("Cancellation",{requestId:n}),className:"w-full bg-red-600 py-4 rounded-2xl items-center flex-row justify-center shadow-md active:opacity-80 mb-36",children:[(0,b.jsx)(I.default,{name:"close-circle",size:20,color:"white"}),(0,b.jsx)(A.default,{className:"ml-2 text-white font-black text-base uppercase tracking-widest",children:"Cancel Request"})]})]})})]})})]})})};var De=a(2660),Oe=a(2772);const Re=()=>{const{checkAuth:e}=p(),[t,a]=(0,d.useState)([]),[s,r]=(0,d.useState)(!0),[l,c]=(0,d.useState)(!1);(0,d.useEffect)(()=>{i()},[]);const i=async()=>{r(!0);try{await e();const t=await g.get("/Profile/UserHistory/"),s=t.data?.sort((e,t)=>new Date(t.created_at)-new Date(e.created_at))||[];a(s)}catch(t){console.error("History fetch error:",t)}finally{r(!1),c(!1)}},u=e=>{if(!e)return"";return new Date(e).toLocaleDateString("en-IN",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})};return s&&!l?(0,b.jsx)(O.SafeAreaView,{className:"flex-1 bg-white justify-center items-center",children:(0,b.jsx)(n.default,{size:"large",color:"#000"})}):(0,b.jsxs)(O.SafeAreaView,{className:"flex-1 bg-white",children:[(0,b.jsx)(o.default,{className:"p-4 border-b border-gray-100 bg-white z-10",children:(0,b.jsx)(A.default,{className:"text-lg font-bold text-gray-900 text-center",children:"Your Services"})}),(0,b.jsx)(Oe.default,{refreshControl:(0,b.jsx)(De.default,{refreshing:l,onRefresh:()=>{c(!0),i()}}),contentContainerStyle:{padding:24,paddingBottom:100},showsVerticalScrollIndicator:!1,children:t.length>0?t.map(e=>{const t=(e=>{switch(e){case"COMPLETED":return"bg-green-100 text-green-700 border-green-500";case"CANCELLED":return"bg-red-100 text-red-700 border-red-500";case"EXPIRED":return"bg-gray-100 text-gray-700 border-gray-500";default:return"bg-gray-100 text-gray-700 border-gray-400"}})(e.status);return(0,b.jsxs)(o.default,{className:"bg-white rounded-2xl p-4 mb-4 shadow-sm border border-gray-100",children:[(0,b.jsxs)(o.default,{className:"flex-row justify-between items-start mb-2",children:[(0,b.jsxs)(o.default,{className:"flex-row items-center space-x-2",children:[(0,b.jsx)(o.default,{className:"p-2 rounded-full "+("COMPLETED"===e.status?"bg-green-50":"bg-red-50"),children:"car"===e.vehical_type?(0,b.jsx)(I.default,{name:"car-sport",size:20,color:"COMPLETED"===e.status?"#16a34a":"#ef4444"}):(0,b.jsx)(L.default,{name:"motorbike",size:20,color:"COMPLETED"===e.status?"#16a34a":"#ef4444"})}),(0,b.jsxs)(o.default,{children:[(0,b.jsx)(A.default,{className:"text-gray-900 font-bold text-base",children:e.problem}),(0,b.jsx)(A.default,{className:"text-xs text-gray-400",children:u(e.created_at)})]})]}),(0,b.jsx)(o.default,{className:`px-2 py-1 rounded-lg border ${t.split(" ")[2]} ${t.split(" ")[0]}`,children:(0,b.jsx)(A.default,{className:`text-xs font-bold ${t.split(" ")[1]}`,children:e.status})})]}),(0,b.jsxs)(o.default,{className:"mt-2 space-y-1",children:[(0,b.jsxs)(o.default,{className:"flex-row items-start",children:[(0,b.jsx)(I.default,{name:"location-sharp",size:14,color:"#9ca3af",style:{marginTop:2,marginRight:4}}),(0,b.jsx)(A.default,{className:"text-gray-500 text-sm flex-1",numberOfLines:2,children:e.location})]}),e.price&&(0,b.jsxs)(A.default,{className:"text-gray-900 font-bold text-lg mt-2",children:["\u20b9",e.price]})]})]},e.id)}):(0,b.jsxs)(o.default,{className:"items-center py-20",children:[(0,b.jsx)(I.default,{name:"documents-outline",size:48,color:"#d1d5db"}),(0,b.jsx)(A.default,{className:"text-gray-400 mt-4",children:"No services found"})]})})]})},Ie=({navigation:e,route:t})=>{const{type:a,title:s}=t.params||{};return(0,b.jsxs)(O.SafeAreaView,{className:"flex-1 bg-white",children:[(0,b.jsx)(V.default,{barStyle:"dark-content"}),(0,b.jsx)(o.default,{className:"bg-white px-4 pb-4 border-b border-gray-200 pt-2",children:(0,b.jsxs)(o.default,{className:"flex-row items-center",children:[(0,b.jsx)(D.default,{onPress:()=>e.goBack(),className:"p-2 bg-gray-100 rounded-full mr-4",children:(0,b.jsx)(I.default,{name:"arrow-back",size:24,color:"#374151"})}),(0,b.jsx)(A.default,{className:"text-xl font-bold text-gray-900 flex-1",numberOfLines:1,children:s||"Legal Information"})]})}),(0,b.jsxs)(Oe.default,{className:"flex-1 px-5 py-6",showsVerticalScrollIndicator:!1,children:[(e=>{switch(e){case"terms":return(0,b.jsxs)(o.default,{children:[(0,b.jsx)(A.default,{className:"text-gray-600 mb-4 leading-6",children:"Welcome to Mechanic Setu. By using our app, you agree to the following terms and conditions..."}),(0,b.jsx)(A.default,{className:"font-bold text-gray-800 mb-2",children:"1. Service Usage"}),(0,b.jsx)(A.default,{className:"text-gray-600 mb-4 leading-6",children:"You agree to use the service for lawful purposes only..."})]});case"privacy":return(0,b.jsxs)(o.default,{children:[(0,b.jsx)(A.default,{className:"text-gray-600 mb-4 leading-6",children:"Your privacy is important to us..."}),(0,b.jsx)(A.default,{className:"font-bold text-gray-800 mb-2",children:"Data Collection"}),(0,b.jsx)(A.default,{className:"text-gray-600 mb-4 leading-6",children:"We collect location data to connect you with nearby mechanics..."})]});case"about":return(0,b.jsx)(o.default,{children:(0,b.jsx)(A.default,{className:"text-gray-600 mb-4 leading-6",children:"Mechanic Setu is dedicated to helping vehicle owners find reliable mechanics quickly..."})});default:return(0,b.jsx)(A.default,{className:"text-gray-500",children:"Content not available."})}})(a),(0,b.jsx)(o.default,{className:"h-10"})]})]})};var Le=a(8102),Me=a(4767),Fe=a(6773);function ze({navigation:e}){const{login:t,isAuthenticated:s}=p(),[r,l]=(0,d.useState)(""),[n,c]=(0,d.useState)(!1);(0,d.useEffect)(()=>{(async()=>{console.log("LoginScreen: Mounting...");try{const e=await SecureStore.getItemAsync("UserCookies");console.log("LoginScreen: Current Cookies in Store:",e)}catch(e){console.log("LoginScreen: No cookies or Store error")}console.log("LoginScreen: Current Auth State (isAuthenticated):",s)})()},[s]),(0,d.useEffect)(()=>{s&&(console.log("LoginScreen: User is authenticated. Redirecting to Home..."),e.canGoBack()&&e.goBack())},[s]),console.log("LoginScreen: Rendering");Le.default.expoConfig;return(0,b.jsx)(O.SafeAreaView,{className:"flex-1 bg-white",children:(0,b.jsx)(Me.default,{behavior:"height",className:"flex-1",children:(0,b.jsxs)(Oe.default,{contentContainerStyle:{flexGrow:1},keyboardShouldPersistTaps:"handled",children:[(0,b.jsxs)(o.default,{className:"h-[35%] bg-blue-50 w-full items-center justify-center rounded-b-[40px] mb-8 overflow-hidden relative",children:[(0,b.jsx)(o.default,{className:"absolute -top-10 -left-10 w-40 h-40 bg-blue-100 rounded-full opacity-50"}),(0,b.jsx)(o.default,{className:"w-40 h-40 items-center justify-center p-2",children:(0,b.jsx)(Y.default,{className:"w-full h-full rounded-xl",source:a(4082)})}),(0,b.jsx)(A.default,{className:"text-3xl font-extrabold text-gray-900 text-center",children:"Mechanic Setu"})]}),(0,b.jsxs)(o.default,{className:"px-6 flex-1",children:[(0,b.jsx)(o.default,{className:"items-center mb-8",children:(0,b.jsx)(A.default,{className:"text-xl text-gray-600 font-medium",children:"Log in or Sign up"})}),(0,b.jsxs)(o.default,{className:"w-full space-y-6",children:[(0,b.jsx)(Fe.default,{placeholder:"Enter your email",className:"w-full px-5 py-4 bg-white rounded-xl text-gray-900 border border-gray-300 mb-4 text-lg",value:r,onChangeText:l,autoCapitalize:"none",keyboardType:"email-address"}),(0,b.jsx)(D.default,{onPress:async()=>{if(console.log("LoginScreen: handleEmailLogin pressed with",r),r)try{c(!0),console.log("LoginScreen: Calling login function...");const a=await t(r);console.log("LoginScreen: Login function returned",a),e.navigate("Verify",{key:a.key,id:a.id,status:a.status,email:r})}catch(a){console.error("LoginScreen: Error caught",a);const e=a.response?.data?.error||"Login failed. Please try again.";C.default.alert("Login Failed",e)}finally{c(!1)}else C.default.alert("Error","Please enter your email.")},disabled:n,className:"w-full py-4 rounded-xl items-center justify-center "+(n?"bg-gray-400":"bg-gray-900"),children:(0,b.jsx)(A.default,{className:"text-white font-bold text-lg",children:n?"Processing...":"Continue"})})]})]})]})})})}var Ye=a(8715),Ve=a(9632),qe=a(8264),$e=a(8703);const Be=({visible:e,onClose:t,mechanicName:a,userLocation:s})=>(0,b.jsx)(qe.default,{visible:e,transparent:!0,animationType:"fade",onRequestClose:t,children:(0,b.jsx)(D.default,{activeOpacity:1,onPress:t,className:"flex-1 bg-black/50 justify-end",children:(0,b.jsx)(D.default,{activeOpacity:1,children:(0,b.jsxs)(c.default.View,{entering:c.SlideInDown.springify(),className:"bg-white rounded-t-3xl",children:[(0,b.jsx)(D.default,{onPress:t,className:"absolute top-4 right-4 w-8 h-8 bg-gray-100 rounded-full items-center justify-center z-10",children:(0,b.jsx)(I.default,{name:"close",size:20,color:"#6b7280"})}),(0,b.jsx)(o.default,{className:"p-6 pb-4",children:(0,b.jsxs)(o.default,{className:"flex-row items-center mb-2",children:[(0,b.jsx)(o.default,{className:"w-12 h-12 bg-blue-100 rounded-full items-center justify-center mr-3",children:(0,b.jsx)(I.default,{name:"shield-checkmark",size:24,color:"#3b82f6"})}),(0,b.jsx)(A.default,{className:"text-2xl font-black text-gray-900",children:"Safety Toolkit"})]})}),(0,b.jsx)(o.default,{className:"h-px bg-gray-100 mx-6"}),(0,b.jsxs)(o.default,{className:"p-6",children:[(0,b.jsxs)(D.default,{onPress:async()=>{try{const e=`https://www.google.com/maps?q=${s.latitude},${s.longitude}`;await $e.default.share({message:`I'm currently at this location getting vehicle service from ${a}. Track me here: ${e}`,title:"Share Live Location"})}catch(e){console.error("Error sharing location:",e)}},className:"flex-row items-center py-4 border-b border-gray-100",children:[(0,b.jsx)(o.default,{className:"w-10 h-10 bg-gray-50 rounded-full items-center justify-center mr-4",children:(0,b.jsx)(I.default,{name:"share-social",size:20,color:"#374151"})}),(0,b.jsxs)(o.default,{className:"flex-1",children:[(0,b.jsx)(A.default,{className:"text-gray-900 font-bold text-base mb-0.5",children:"Share live location"}),(0,b.jsx)(A.default,{className:"text-gray-500 text-sm",children:"Let your dear ones keep track of your location and trip status"})]}),(0,b.jsx)(I.default,{name:"chevron-forward",size:20,color:"#d1d5db"})]}),(0,b.jsxs)(D.default,{onPress:()=>{C.default.alert("Mechanic Setu Helpline","Call our 24/7 support helpline for any safety concerns or issues.",[{text:"Cancel",style:"cancel"},{text:"Call Support",onPress:()=>Ve.default.openURL("tel:18001234567")}])},className:"flex-row items-center py-4 border-b border-gray-100",children:[(0,b.jsx)(o.default,{className:"w-10 h-10 bg-gray-50 rounded-full items-center justify-center mr-4",children:(0,b.jsx)(I.default,{name:"call",size:20,color:"#374151"})}),(0,b.jsxs)(o.default,{className:"flex-1",children:[(0,b.jsx)(A.default,{className:"text-gray-900 font-bold text-base mb-0.5",children:"Mechanic Setu helpline"}),(0,b.jsx)(A.default,{className:"text-gray-500 text-sm",children:"Call us 24/7 to report any safety issue"})]}),(0,b.jsx)(I.default,{name:"chevron-forward",size:20,color:"#d1d5db"})]}),(0,b.jsxs)(D.default,{onPress:()=>{C.default.alert("Report an Issue","What would you like to report?",[{text:"Safety Concern",onPress:()=>C.default.alert("Thank you","Your safety concern has been reported to our team.")},{text:"Service Quality",onPress:()=>C.default.alert("Thank you","Your feedback has been recorded.")},{text:"Other Issue",onPress:()=>C.default.alert("Thank you","Our team will review your report.")},{text:"Cancel",style:"cancel"}])},className:"flex-row items-center py-4 border-b border-gray-100",children:[(0,b.jsx)(o.default,{className:"w-10 h-10 bg-gray-50 rounded-full items-center justify-center mr-4",children:(0,b.jsx)(I.default,{name:"flag",size:20,color:"#374151"})}),(0,b.jsxs)(o.default,{className:"flex-1",children:[(0,b.jsx)(A.default,{className:"text-gray-900 font-bold text-base mb-0.5",children:"Report an issue"}),(0,b.jsx)(A.default,{className:"text-gray-500 text-sm",children:"Let us know your issue and we will try to improve"})]}),(0,b.jsx)(I.default,{name:"chevron-forward",size:20,color:"#d1d5db"})]}),(0,b.jsxs)(D.default,{onPress:()=>{C.default.alert("Emergency Call","Do you want to call 112 (Emergency Services)?",[{text:"Cancel",style:"cancel"},{text:"Call",onPress:()=>Ve.default.openURL("tel:112"),style:"destructive"}])},className:"flex-row items-center py-4",children:[(0,b.jsx)(o.default,{className:"w-10 h-10 bg-red-50 rounded-full items-center justify-center mr-4",children:(0,b.jsx)(I.default,{name:"warning",size:20,color:"#ef4444"})}),(0,b.jsxs)(o.default,{className:"flex-1",children:[(0,b.jsx)(A.default,{className:"text-gray-900 font-bold text-base mb-0.5",children:"Call 112"}),(0,b.jsx)(A.default,{className:"text-gray-500 text-sm",children:"24/7 Police helpline. Use in case of emergency."})]}),(0,b.jsx)(I.default,{name:"chevron-forward",size:20,color:"#d1d5db"})]})]}),(0,b.jsx)(o.default,{className:"h-8"})]})})})});var Ue=a(8891),We=a(3008),Xe=a(6398);a(9450),a(9585),a(8541);We.setNotificationHandler({handleNotification:async()=>({shouldShowAlert:!0,shouldShowBanner:!0,shouldShowList:!0,shouldPlaySound:!0,shouldSetBadge:!0})});const{width:He,height:Ge}=z.default.get("window"),Je={COLLAPSED:.65*Ge,EXPANDED:.35*Ge},Ke="mechanicAcceptedData",Ze="punctureRequestFormData";function Qe(e,t,a,s){var r=et(a-e),l=et(s-t),n=Math.sin(r/2)*Math.sin(r/2)+Math.cos(et(e))*Math.cos(et(a))*Math.sin(l/2)*Math.sin(l/2);return 6371*(2*Math.atan2(Math.sqrt(n),Math.sqrt(1-n)))}function et(e){return e*(Math.PI/180)}const tt={code:"function MechanicFoundScreenJsx1(){const{translateY,SNAP_POINTS,withTiming}=this.__closure;if(translateY.value<(SNAP_POINTS.COLLAPSED+SNAP_POINTS.EXPANDED)/2){translateY.value=withTiming(SNAP_POINTS.EXPANDED,{duration:300});}else{translateY.value=withTiming(SNAP_POINTS.COLLAPSED,{duration:300});}}"},at={code:"function MechanicFoundScreenJsx2(event){const{translateY,context,SNAP_POINTS}=this.__closure;translateY.value=event.translationY+context.value.y;translateY.value=Math.max(SNAP_POINTS.EXPANDED,Math.min(translateY.value,SNAP_POINTS.COLLAPSED+50));}"},st={code:"function MechanicFoundScreenJsx3(){const{context,translateY}=this.__closure;context.value={y:translateY.value};}"},rt={code:"function MechanicFoundScreenJsx4(){const{translateY,height}=this.__closure;return{transform:[{translateY:translateY.value}],height:height,top:0,marginBottom:16};}"},lt={code:"function MechanicFoundScreenJsx5(){const{translateY}=this.__closure;return{transform:[{translateY:translateY.value-80}]};}"},nt=({route:e})=>{const t=(0,r.useNavigation)(),s=(0,r.useIsFocused)(),{data:l,userLocation:u,vehicleType:f,problem:m}=e.params||{},{socket:h,lastMessage:x,connectionStatus:g,setActiveJobId:y}=S();console.log(l),console.log(u);const[p,w]=(0,d.useState)(null),[j,N]=(0,d.useState)(null),[_,v]=(0,d.useState)(u||null),[P,k]=(0,d.useState)(null),[R,L]=(0,d.useState)(null),[M,F]=(0,d.useState)(null);(0,d.useEffect)(()=>{console.log("%c[MechanicFound] \ud83c\udf10 WebSocket State:","color: #06b6d4; font-weight: bold;",{hasSocket:!!h,connectionStatus:g,hasLastMessage:!!x,lastMessageType:x?.type,requestId:M,isFocused:s})},[h,g,x,M,s]);const[z,V]=(0,d.useState)([]),[$,B]=(0,d.useState)(null),U=(0,d.useRef)(!0);(0,d.useEffect)(()=>(U.current=!0,()=>{U.current=!1}),[]),(0,d.useEffect)(()=>{(async()=>{const e=await ie();V(e)})()},[]);const[W,X]=(0,d.useState)(!1),[H,G]=(0,d.useState)(!1),[J,K]=(0,d.useState)(!1),[Z,Q]=(0,d.useState)(!1),[ee,te]=(0,d.useState)(!0),[re,oe]=(0,d.useState)(Date.now()),ce=(0,d.useRef)(null),de=(0,d.useRef)(null),ue=(0,c.useSharedValue)(Je.COLLAPSED),fe=(0,c.useSharedValue)({y:0}),me=q.Gesture.Pan().onStart(function({_worklet_12503117083519_init_data:e,context:t,translateY:a}){const s=function(){t.value={y:a.value}};return s.__closure={context:t,translateY:a},s.__workletHash=0xb5f1bda337f,s.__initData=e,s}({_worklet_12503117083519_init_data:st,context:fe,translateY:ue})).onUpdate(function({_worklet_8578618404069_init_data:e,translateY:t,context:a,SNAP_POINTS:s}){const r=function(e){t.value=e.translationY+a.value.y,t.value=Math.max(s.EXPANDED,Math.min(t.value,s.COLLAPSED+50))};return r.__closure={translateY:t,context:a,SNAP_POINTS:s},r.__workletHash=8578618404069,r.__initData=e,r}({_worklet_8578618404069_init_data:at,translateY:ue,context:fe,SNAP_POINTS:Je})).onEnd(function({_worklet_3118902542387_init_data:e,translateY:t,SNAP_POINTS:a,withTiming:s}){const r=function(){t.value<(a.COLLAPSED+a.EXPANDED)/2?t.value=s(a.EXPANDED,{duration:300}):t.value=s(a.COLLAPSED,{duration:300})};return r.__closure={translateY:t,SNAP_POINTS:a,withTiming:s},r.__workletHash=3118902542387,r.__initData=e,r}({_worklet_3118902542387_init_data:tt,translateY:ue,SNAP_POINTS:Je,withTiming:c.withTiming})),he=(0,c.useAnimatedStyle)(function({_worklet_7467925905438_init_data:e,translateY:t,height:a}){const s=function(){return{transform:[{translateY:t.value}],height:a,top:0,marginBottom:16}};return s.__closure={translateY:t,height:a},s.__workletHash=7467925905438,s.__initData=e,s}({_worklet_7467925905438_init_data:rt,translateY:ue,height:Ge})),xe=(0,c.useAnimatedStyle)(function({_worklet_2270323812018_init_data:e,translateY:t}){const a=function(){return{transform:[{translateY:t.value-80}]}};return a.__closure={translateY:t},a.__workletHash=2270323812018,a.__initData=e,a}({_worklet_2270323812018_init_data:lt,translateY:ue}));(0,d.useEffect)(()=>{(async()=>{if(l){const e=l.mechanic_details,t=l.job_id||l.request_id;console.log("%c[MechanicFound] \ud83d\ude80 Initial Load:","color: #8b5cf6; font-weight: bold;",{requestId:t,requestIdType:typeof t,mechanicName:`${e.first_name} ${e.last_name}`,mechanicId:e.id,routeData:l}),w(e),F(t),y?.(t),e.current_latitude&&k({latitude:parseFloat(e.current_latitude),longitude:parseFloat(e.current_longitude)}),u&&v(u);const a={mechanic:e,request_id:t,user_location:u};await i.setItemAsync(Ke,JSON.stringify(a))}else{const e=await i.getItemAsync(Ke);if(e){const t=JSON.parse(e);w(t.mechanic),F(t.request_id),y?.(t.request_id),v(t.user_location)}}try{const e=await i.getItemAsync(Ze);if(e){const t=JSON.parse(e);N(t)}else(f||m)&&N({vehicleType:f,problem:m})}catch(e){console.error("Failed to load form data",e)}})()},[l]),(0,d.useEffect)(()=>{if(console.log("%c[MechanicFound] \ud83d\udd12 Guard Check:","color: #f59e0b;",{hasLastMessage:!!x,hasRequestId:!!M,isFocused:s,willProcess:!(!x||!M||!s)}),!x||!M||!s)return;if(console.log("%c[MechanicFound] \ud83d\udd14 WebSocket Message Received:","color: #eab308; font-weight: bold;",{type:x.type,request_id:x.request_id,job_id:x.job_id,currentRequestId:M,fullMessage:x}),"mechanic_location_update"===x.type){const e=p?.id,t=x.mechanic_id;console.log("%c[MechanicFound] \ud83d\udccd Received Location Update:","color: #10b981; font-weight: bold;",{latitude:x.latitude,longitude:x.longitude,mechanic_id:t,expected_mechanic_id:e,job_id:x.job_id,timestamp:(new Date).toLocaleTimeString()}),e&&t!==e?console.warn("[MechanicFound] \u26a0\ufe0f Mechanic ID mismatch, ignoring location update"):(k({latitude:parseFloat(x.latitude),longitude:parseFloat(x.longitude)}),oe(Date.now()),te(!0))}if(String(x.request_id||x.job_id)===String(M)&&U.current)switch(x.type){case"job_completed":X(!0),y?.(null),i.deleteItemAsync(Ke),i.deleteItemAsync(Ze),setTimeout(()=>{U.current&&T("Main")},4e3);break;case"job_cancelled":case"job_cancelled_notification":G(!0),y?.(null),i.deleteItemAsync(Ke),i.deleteItemAsync(Ze),setTimeout(()=>{U.current&&T("Main")},4e3);break;case"mechanic_arrived":K(!0),C.default.alert("Mechanic Arrived","The mechanic has arrived at your location!")}},[x,M,s]),(0,d.useEffect)(()=>{if(_&&P&&p){const e=function(e,t){if(!e||!t)return null;const a=Qe(e.latitude,e.longitude,t.latitude,t.longitude);return Math.round(a/30*60)+1}(_,P);L(e);const t=Qe(_.latitude,_.longitude,P.latitude,P.longitude);!async function({mechanicName:e,estimatedTime:t,distance:a}){}({mechanicName:`${p.first_name} ${p.last_name}`,estimatedTime:e,distance:t}),de.current&&de.current.fitToCoordinates([_,P],{edgePadding:{top:120,right:50,bottom:Ge/2,left:50},animated:!0})}},[_,P]),(0,d.useEffect)(()=>{if(!p||!M)return;return ce.current=setInterval(()=>{const e=Date.now()-re;e>12e4?ee&&(console.warn(`[MechanicFound] Mechanic appears disconnected. No location update for ${Math.floor(e/1e3)}s`),te(!1)):ee||(console.log("[MechanicFound] Mechanic reconnected!"),te(!0))},5e3),()=>{ce.current&&clearInterval(ce.current)}},[p,M,re,ee]);(0,d.useEffect)(()=>{console.log("[MechanicFoundScreen] Mounted. Navigation Prop:",t?"Present":"Missing")},[]);console.log("Current State -> Mechanic:",!!p,"JobDetails:",j);if(!p||!_)return(0,b.jsxs)(O.SafeAreaView,{className:"flex-1 bg-white items-center justify-center",children:[(0,b.jsx)(n.default,{size:"large",color:"#2563eb"}),(0,b.jsx)(A.default,{className:"mt-4 text-gray-500 font-medium",children:"Synced with server..."}),(0,b.jsx)(D.default,{onPress:()=>E("Main"),className:"mt-8 p-2",children:(0,b.jsx)(A.default,{className:"text-red-400",children:"Cancel & Home"})})]});return(0,b.jsxs)(o.default,{style:{flex:1},children:[W&&(0,b.jsxs)(c.default.View,{entering:c.FadeIn,className:"absolute top-0 left-0 right-0 bottom-0 bg-white z-50 items-center justify-center px-6",children:[(0,b.jsx)(c.default.View,{entering:c.ZoomIn.delay(200),className:"w-32 h-32 bg-green-600 rounded-full items-center justify-center mb-8 shadow-xl shadow-green-200",children:(0,b.jsx)(I.default,{name:"checkmark",size:64,color:"white"})}),(0,b.jsx)(c.default.Text,{entering:c.FadeIn.delay(400),className:"text-2xl font-black text-gray-900 mb-2 tracking-wider uppercase text-center",children:"Service Completed"}),(0,b.jsx)(c.default.Text,{entering:c.FadeIn.delay(600),className:"text-gray-500 font-medium text-center mb-8 text-base",children:"Hope you are safe now. Thank you for using Mechanic Setu!"}),p&&(0,b.jsxs)(c.default.View,{entering:c.FadeIn.delay(800),className:"bg-gray-50 p-4 rounded-2xl w-full items-center border border-gray-100 mb-8",children:[(0,b.jsx)(A.default,{className:"text-xs font-bold text-gray-400 uppercase mb-2",children:"Service Provided By"}),(0,b.jsxs)(A.default,{className:"text-gray-900 font-bold text-lg text-center leading-6",children:[p.first_name," ",p.last_name]})]}),(0,b.jsx)(c.default.Text,{entering:c.FadeIn.delay(1e3),className:"text-gray-400 font-bold uppercase tracking-widest text-xs",children:"Redirecting to Home..."})]}),H&&(0,b.jsxs)(c.default.View,{entering:c.FadeIn,className:"absolute top-0 left-0 right-0 bottom-0 bg-white z-50 items-center justify-center px-6",children:[(0,b.jsx)(c.default.View,{entering:c.ZoomIn.delay(200),className:"w-32 h-32 bg-red-100 rounded-full items-center justify-center mb-8",children:(0,b.jsx)(I.default,{name:"close",size:64,color:"#dc2626"})}),(0,b.jsx)(c.default.Text,{entering:c.FadeIn.delay(400),className:"text-2xl font-black text-gray-900 mb-2 tracking-wider uppercase text-center",children:"Request Cancelled"}),(0,b.jsx)(c.default.Text,{entering:c.FadeIn.delay(600),className:"text-gray-500 font-medium text-center mb-8 text-base",children:"Your service request has been cancelled."}),(0,b.jsx)(c.default.Text,{entering:c.FadeIn.delay(800),className:"text-gray-400 font-bold uppercase tracking-widest text-xs",children:"Redirecting to Home..."})]}),(0,b.jsxs)(o.default,{className:"flex-1 bg-white",children:[(0,b.jsxs)(le,{ref:de,provider:ne,style:{flex:1},customMapStyle:[{elementType:"geometry",stylers:[{color:"#f5f7fa"}]},{elementType:"labels.icon",stylers:[{visibility:"off"}]},{elementType:"labels.text.fill",stylers:[{color:"#4a5568"}]},{elementType:"labels.text.stroke",stylers:[{color:"#f5f7fa"}]},{featureType:"administrative",elementType:"geometry.stroke",stylers:[{color:"#cbd5e0"}]},{featureType:"administrative.land_parcel",stylers:[{visibility:"off"}]},{featureType:"poi",stylers:[{visibility:"off"}]},{featureType:"poi.park",stylers:[{visibility:"on"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#e6f4ea"}]},{featureType:"poi.park",elementType:"geometry.fill",stylers:[{color:"#b7e6c6"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#ffffff"}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{color:"#e2e8f0",weight:1}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{color:"#edf2f7"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#e2e8f0"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#cbd5e0",weight:1.5}]},{featureType:"road.local",elementType:"labels.text.fill",stylers:[{color:"#a0aec0"}]},{featureType:"transit",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#4299e1"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#2d3748"}]},{featureType:"landscape.natural",elementType:"geometry",stylers:[{color:"#e6f4ea"}]},{featureType:"landscape.natural.landcover",elementType:"geometry",stylers:[{color:"#c6f6d5"}]},{featureType:"landscape.natural.terrain",elementType:"geometry",stylers:[{color:"#d4edda"}]}],initialRegion:Object.assign({},_,{latitudeDelta:.05,longitudeDelta:.05}),children:[_&&P&&(0,b.jsx)(se,{coordinates:[_,P],strokeColor:"black",strokeWidth:2,lineDashPattern:[10,10],geodesic:!0}),(0,b.jsx)(ae,{coordinate:_,children:(0,b.jsx)(o.default,{className:"items-center justify-center",children:(0,b.jsx)(Y.default,{source:a(4082),style:{width:35,height:35,borderRadius:17.5,borderWidth:3,borderColor:"#10b981"}})})}),P&&(0,b.jsx)(ae,{coordinate:P,children:(0,b.jsxs)(o.default,{className:"items-center justify-center",children:[p.Mechanic_profile_pic?(0,b.jsx)(Y.default,{source:{uri:p.Mechanic_profile_pic},style:{width:35,height:35,borderRadius:17.5,borderWidth:3,borderColor:ee?"#3b82f6":"#ef4444"}}):(0,b.jsx)(o.default,{className:"w-9 h-9 rounded-full border-2 border-white items-center justify-center "+(ee?"bg-blue-500":"bg-red-500"),children:(0,b.jsx)(I.default,{name:"construct",color:"white",size:20})}),(0,b.jsx)(o.default,{className:"absolute -top-1 -right-1 w-3 h-3 rounded-full border-2 border-white "+(ee?"bg-green-500":"bg-red-500")})]})}),z.map(e=>(0,b.jsx)(ae,{coordinate:{latitude:e.latitude,longitude:e.longitude},onPress:()=>B(e),children:(0,b.jsx)(o.default,{className:"bg-white p-0.5 rounded-full border-2 border-amber-400 shadow-lg overflow-hidden",style:{width:36,height:36},children:(0,b.jsx)(Y.default,{source:{uri:e.logo},className:"w-full h-full rounded-full",resizeMode:"cover"})})},`ad-${e.id}`))]}),!ee&&(0,b.jsx)(c.default.View,{entering:c.FadeIn,className:"absolute top-0 left-0 right-0 z-20 bg-red-500 py-2 px-4",children:(0,b.jsx)(O.SafeAreaView,{edges:["top"],children:(0,b.jsxs)(o.default,{className:"flex-row items-center justify-center",children:[(0,b.jsx)(I.default,{name:"warning",size:16,color:"white"}),(0,b.jsx)(A.default,{className:"text-white font-bold text-xs ml-2",children:"Mechanic connection lost. Trying to reconnect..."})]})})}),(0,b.jsx)(o.default,{className:`absolute ${ee?"-top-8":"top-10"} left-0 right-0 z-10 ${J?"bg-blue-600":"bg-green-600"} shadow-md pb-4 pt-2`,children:(0,b.jsxs)(o.default,{className:"px-4 flex-row mt-14 items-center pb-3 pt-4 mb-2",children:[(0,b.jsx)(D.default,{onPress:()=>t.goBack(),className:"mr-2",children:(0,b.jsx)(I.default,{name:"chevron-back",size:28,color:"white"})}),(0,b.jsxs)(o.default,{className:"flex-1 items-center mr-8",children:[(0,b.jsx)(A.default,{className:J?"text-blue-100 text-xs font-bold uppercase tracking-wider mb-0.5":"text-white text-xs font-bold uppercase tracking-wider mb-0.5",children:J?"Status Update":"Mechanic is on the way"}),(0,b.jsx)(A.default,{className:"text-white text-2xl font-extrabold",children:J?"Mechanic Arrived":R?`Arriving in ${R} mins`:"Calculating ETA..."})]})]})}),(0,b.jsx)(c.default.View,{style:[{position:"absolute",top:0,right:16,zIndex:20},xe],children:(0,b.jsxs)(D.default,{onPress:()=>Q(!0),className:"bg-white rounded-full shadow-lg px-4 py-2 flex-row items-center",style:{elevation:5},children:[(0,b.jsx)(I.default,{name:"shield-checkmark",size:18,color:"#3b82f6"}),(0,b.jsx)(A.default,{className:"text-blue-600 font-bold text-sm ml-1.5",children:"Safety"})]})}),(0,b.jsx)(q.GestureDetector,{gesture:me,children:(0,b.jsxs)(c.default.View,{style:[{position:"absolute",left:0,right:0,backgroundColor:"white",borderTopLeftRadius:30,borderTopRightRadius:30,elevation:10,paddingTop:10,marginBottom:3},he],children:[(0,b.jsx)(o.default,{className:"w-12 h-1.5 bg-gray-300 rounded-full self-center mb-2"}),(0,b.jsx)(q.ScrollView,{children:(0,b.jsxs)(o.default,{className:"px-6 pb-10 mb-52 ",children:[(0,b.jsxs)(o.default,{className:"flex-row items-center gap-4 mb-6",children:[(0,b.jsx)(o.default,{className:"w-16 h-16 rounded-full bg-gray-200 border-2 border-gray-500 overflow-hidden",children:p.Mechanic_profile_pic?(0,b.jsx)(Y.default,{source:{uri:p.Mechanic_profile_pic},className:"w-full h-full"}):(0,b.jsx)(o.default,{className:"w-full h-full bg-gray-300 items-center justify-center",children:(0,b.jsx)(A.default,{className:"text-xl font-bold",children:p.first_name[0]})})}),(0,b.jsxs)(o.default,{className:"flex-1",children:[(0,b.jsxs)(A.default,{className:"text-lg font-bold text-gray-900",children:[p.first_name," ",p.last_name]}),(0,b.jsx)(A.default,{className:"text-gray-500 text-sm",children:"Verified Mechanic"})]}),(0,b.jsx)(D.default,{onPress:()=>{p?.phone_number?Ve.default.openURL(`tel:${p.phone_number}`):alert("Phone number not available")},className:"w-12 h-12 bg-white rounded-full border border-gray-400 items-center justify-center",children:(0,b.jsx)(Ye.default,{name:"phone-call",size:15,color:"green"})})]}),(0,b.jsxs)(o.default,{className:"bg-gray-50 p-4 rounded-2xl mb-6",children:[(0,b.jsx)(A.default,{className:"text-xs font-bold text-gray-400 uppercase mb-2",children:"Issue Reported"}),(0,b.jsx)(A.default,{className:"text-gray-900 font-bold text-lg",children:j?.problem||"General Breakdown"}),(j?.vehicleType||j?.vehical_type)&&(0,b.jsx)(A.default,{className:"text-blue-600 font-medium mt-1 capitalize",children:j.vehicleType||j.vehical_type})]}),(0,b.jsxs)(D.default,{onPress:()=>Q(!0),className:"bg-blue-50 rounded-2xl p-4 mb-6 flex-row items-center",children:[(0,b.jsx)(o.default,{className:"w-10 h-10 bg-blue-500 rounded-full items-center justify-center mr-3",children:(0,b.jsx)(I.default,{name:"headset",size:20,color:"white"})}),(0,b.jsxs)(o.default,{className:"flex-1",children:[(0,b.jsx)(A.default,{className:"text-gray-900 font-bold text-base",children:"Having an issue?"}),(0,b.jsx)(A.default,{className:"text-gray-500 text-sm",children:"We're a tap away"})]}),(0,b.jsx)(I.default,{name:"chevron-forward",size:20,color:"#9ca3af"})]}),(0,b.jsxs)(o.default,{className:"mb-6  ",children:[(0,b.jsx)(A.default,{className:"mr-6 text-xs font-bold text-gray-400 uppercase tracking-widest mb-3",children:"Recommended for you"}),(0,b.jsx)(ye.default,{data:[{id:"1",type:"image",title:"Flat 20% OFF",subtitle:"on Premium Car Servicing",description:"Book comprehensive car service at your doorstep",bgColor:"#EEF2FF",accentColor:"#4F46E5",image:"https://cdn-icons-png.flaticon.com/512/3097/3097136.png",ctaText:"Book Service",badge:"LIMITED OFFER"},{id:"2",type:"image",title:"Roadside Assistance",subtitle:"24/7 Emergency Support",description:"Get instant help anywhere, anytime",bgColor:"#FEF3C7",accentColor:"#F59E0B",image:"https://cdn-icons-png.flaticon.com/512/2917/2917995.png",ctaText:"Subscribe Now",badge:"\u20b999/Year"},{id:"3",type:"image",title:"Castrol Engine Oil",subtitle:"Magnatec Protection",description:"Premium engine oil with 75% less engine wear",bgColor:"#D1FAE5",accentColor:"#059669",image:"https://cdn-icons-png.flaticon.com/512/2917/2917242.png",ctaText:"Shop Now",badge:"From \u20b9499"},{id:"4",type:"image",title:"Tyre Replacement",subtitle:"Top Brands Available",description:"Get the best deals on premium tyres",bgColor:"#FEE2E2",accentColor:"#DC2626",image:"https://cdn-icons-png.flaticon.com/512/3097/3097039.png",ctaText:"View Offers",badge:"Save Big"},{id:"5",type:"image",title:"Battery Check",subtitle:"Free Inspection",description:"Avoid unexpected breakdowns with battery testing",bgColor:"#DBEAFE",accentColor:"#2563EB",image:"https://cdn-icons-png.flaticon.com/512/2917/2917439.png",ctaText:"Book Now",badge:"FREE"}],renderItem:({item:e})=>(0,b.jsx)(we,{item:e}),scrollEnabled:!1,keyExtractor:e=>e.id})]}),(0,b.jsx)(D.default,{onPress:()=>t.navigate("Cancellation",{requestId:M}),className:"w-full py-4 rounded-xl bg-red-50 flex-row items-center justify-center border border-red-100 mb-36",children:(0,b.jsx)(A.default,{className:"text-red-500 font-bold",children:"Cancel Request"})})]})})]})})]}),(0,b.jsx)(Be,{visible:Z,onClose:()=>Q(!1),mechanicName:p?`${p.first_name} ${p.last_name}`:"your mechanic",userLocation:_})]})};function ot(){(0,r.useNavigation)();const e=(0,r.useRoute)(),{jobDetails:t,userLocation:a}=e.params||{},[s,l]=(0,d.useState)(!0),[i,u]=(0,d.useState)([]);(0,d.useEffect)(()=>{a?.latitude&&f()},[a]);const f=async()=>{try{const e=a.latitude,t=a.longitude,s="https://local-business-data.p.rapidapi.com/search",r={method:"POST",headers:{"Content-Type":"application/json","x-rapidapi-key":"8c4441f91cmsh031f6b727121205p18ef90jsndb7ed43006d7","x-rapidapi-host":"local-business-data.p.rapidapi.com"},body:JSON.stringify({queries:["auto repair","mechanic","car service"],language:"en",region:"in",coordinates:`${e},${t}`,limit:10,offset:0,zoom:13,dedup:!0})},l=await fetch(s,r),n=await l.json();let o=[];n.data&&Array.isArray(n.data)&&(o=n.data);const c=o.map(a=>{const s=function(e,t,a,s){if(!a||!s)return 999;const r=6371,l=m(a-e),n=m(s-t),o=Math.sin(l/2)*Math.sin(l/2)+Math.cos(m(e))*Math.cos(m(a))*Math.sin(n/2)*Math.sin(n/2),c=2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o));return r*c}(e,t,a.latitude,a.longitude);return Object.assign({},a,{distance:s.toFixed(1)})}).filter(e=>parseFloat(e.distance)<=20).sort((e,t)=>parseFloat(e.distance)-parseFloat(t.distance));u(c)}catch(e){console.error("Error fetching nearby mechanics:",e)}finally{l(!1)}};function m(e){return e*(Math.PI/180)}return(0,b.jsxs)(O.SafeAreaView,{className:"flex-1 bg-gray-50 mt-10",children:[(0,b.jsxs)(o.default,{className:"p-4 bg-white shadow-sm mb-4",children:[(0,b.jsxs)(o.default,{className:"flex-row items-center mb-4",children:[(0,b.jsx)(D.default,{onPress:()=>E("Main"),className:"mr-3",children:(0,b.jsx)(I.default,{name:"arrow-back",size:24,color:"black"})}),(0,b.jsx)(A.default,{className:"text-xl font-bold",children:"Mechanics Nearby"})]}),(0,b.jsxs)(c.default.View,{entering:c.FadeInUp.delay(200),className:"bg-red-50 p-3 rounded-lg border border-red-100 m-4 ",children:[(0,b.jsx)(A.default,{className:"text-red-800 font-bold mb-1",children:"No App Mechanic Found"}),(0,b.jsx)(A.default,{className:"text-red-600 text-xs",children:"We couldn't match you with a partner. Here are nearby shops you can contact directly."})]}),t&&(0,b.jsxs)(c.default.View,{entering:c.FadeInUp.delay(300),className:"flex-row items-center",children:[(0,b.jsx)(A.default,{className:"text-gray-500 text-xs font-bold uppercase mr-2",children:"Your Request:"}),(0,b.jsxs)(A.default,{className:"font-bold text-gray-800",children:[t.vehicleType," - ",t.problem]})]})]}),s?(0,b.jsxs)(o.default,{className:"flex-1 items-center justify-center",children:[(0,b.jsx)(n.default,{size:"large",color:"#3b82f6"}),(0,b.jsx)(A.default,{className:"text-gray-500 mt-4",children:"Searching nearby services..."})]}):(0,b.jsx)(ye.default,{data:i,keyExtractor:e=>e.place_id||e.business_id||Math.random().toString(),renderItem:({item:e,index:t})=>(0,b.jsx)(c.default.View,{entering:c.FadeInDown.delay(100*t).springify(),className:"mb-3",children:(0,b.jsxs)(D.default,{className:"bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex-row",onPress:()=>e.phone_number&&Ve.default.openURL(`tel:${e.phone_number}`),children:[(0,b.jsx)(o.default,{className:"w-16 h-16 bg-gray-100 rounded-lg mr-4 overflow-hidden items-center justify-center",children:e.photos_sample?.[0]?.photo_url?(0,b.jsx)(Y.default,{source:{uri:e.photos_sample[0].photo_url},className:"w-full h-full",resizeMode:"cover"}):(0,b.jsx)(I.default,{name:"construct",size:24,color:"#9ca3af"})}),(0,b.jsxs)(o.default,{className:"flex-1",children:[(0,b.jsx)(A.default,{className:"font-bold text-gray-900 text-base mb-1",children:e.name}),(0,b.jsx)(A.default,{className:"text-gray-500 text-xs mb-1",numberOfLines:2,children:e.full_address||e.address}),(0,b.jsxs)(o.default,{className:"flex-row items-center mt-1",children:[e.rating&&(0,b.jsxs)(o.default,{className:"flex-row items-center mr-3",children:[(0,b.jsx)(I.default,{name:"star",size:12,color:"#f59e0b"}),(0,b.jsx)(A.default,{className:"text-xs font-bold text-gray-700 ml-1",children:e.rating}),(0,b.jsxs)(A.default,{className:"text-xs text-gray-400 ml-0.5",children:["(",e.review_count,")"]})]}),e.distance&&(0,b.jsxs)(o.default,{className:"flex-row items-center mr-3",children:[(0,b.jsx)(I.default,{name:"location-outline",size:12,color:"#3b82f6"}),(0,b.jsxs)(A.default,{className:"text-xs text-blue-600 ml-0.5",children:[e.distance," km"]})]}),(0,b.jsx)(A.default,{className:"text-xs font-bold "+("OPEN"===e.business_status?"text-green-600":"text-red-500"),children:e.business_status||(e.opening_status?e.opening_status:"")})]})]}),(0,b.jsx)(o.default,{className:"justify-center pl-2",children:(0,b.jsx)(o.default,{className:"w-10 h-10 bg-green-50 rounded-full items-center justify-center",children:(0,b.jsx)(I.default,{name:"call",size:20,color:"#16a34a"})})})]})}),contentContainerStyle:{padding:16,paddingBottom:100},ListEmptyComponent:(0,b.jsxs)(c.default.View,{entering:c.ZoomIn,className:"items-center justify-center py-20 px-6",children:[(0,b.jsx)(o.default,{className:"w-24 h-24 bg-gray-100 rounded-full items-center justify-center mb-6",children:(0,b.jsx)(I.default,{name:"search",size:48,color:"#9ca3af"})}),(0,b.jsx)(A.default,{className:"text-xl font-bold text-gray-900 mb-2",children:"No Mechanics Found Nearby"}),(0,b.jsx)(A.default,{className:"text-gray-500 text-center mb-8",children:"We couldn't find any auto repair shops in your immediate vicinity using our database."}),(0,b.jsxs)(D.default,{onPress:()=>Ve.default.openURL("https://www.google.com/maps/search/?api=1&query=mechanics_nearby"),className:"bg-white px-6 py-4 rounded-full shadow-md border border-gray-200 flex-row items-center",children:[(0,b.jsx)(Y.default,{source:{uri:"https://upload.wikimedia.org/wikipedia/commons/thumb/c/c1/Google_%22G%22_logo.svg/480px-Google_%22G%22_logo.svg.png"},className:"w-6 h-6 mr-3",resizeMode:"contain"}),(0,b.jsx)(A.default,{className:"font-bold text-gray-700 text-base",children:"Search on Google Maps"})]})]})})]})}const ct=()=>{const e=(0,r.useRoute)(),t=(0,r.useNavigation)(),{checkAuth:a}=p(),{email:s,key:l,id:n,status:c}=e.params||{},[i,u]=(0,d.useState)(""),[f,m]=(0,d.useState)(!1),[h,x]=(0,d.useState)(60),[y,w]=(0,d.useState)(!1),j=(0,d.useRef)(null);(0,d.useEffect)(()=>{const e=setTimeout(()=>{j.current?.focus()},500);return()=>clearTimeout(e)},[]),(0,d.useEffect)(()=>{let e;return h>0?e=setInterval(()=>x(e=>e-1),1e3):w(!0),()=>clearInterval(e)},[h]);return(0,b.jsx)(O.SafeAreaView,{className:"flex-1 bg-white",children:(0,b.jsxs)(Me.default,{behavior:"height",className:"flex-1",children:[(0,b.jsxs)(o.default,{className:"flex-row items-center p-4 border-b border-gray-100",children:[(0,b.jsx)(D.default,{onPress:()=>t.goBack(),className:"p-2",children:(0,b.jsx)(I.default,{name:"arrow-back",size:24,color:"black"})}),(0,b.jsx)(A.default,{className:"flex-1 text-center text-lg font-bold text-gray-900 mr-10",children:"OTP Verification"})]}),(0,b.jsxs)(Oe.default,{contentContainerStyle:{flexGrow:1},keyboardShouldPersistTaps:"handled",children:[(0,b.jsxs)(o.default,{className:"items-center mt-8",children:[(0,b.jsx)(A.default,{className:"text-3xl font-bold text-gray-900 mb-2 text-center",children:"New User"===c?"Welcome to Mechanic Setu":"Welcome Back!"}),(0,b.jsx)(A.default,{className:"text-lg font-medium text-gray-600 mb-6 text-center",children:"OTP Verification"}),(0,b.jsxs)(A.default,{className:"text-gray-500 text-center mb-8 px-8",children:["We have sent a verification code to ","\n",(0,b.jsx)(A.default,{className:"font-bold text-gray-900",children:s})]})]}),(0,b.jsxs)(o.default,{className:"flex-1 px-6 pt-10 items-center",children:[(0,b.jsxs)(D.default,{activeOpacity:1,onPress:()=>j.current?.focus(),className:"relative flex-row justify-between w-full mb-8 px-2",children:[Array(6).fill().map((e,t)=>(0,b.jsx)(o.default,{className:"w-11 h-14 rounded-xl border items-center justify-center "+(i[t]?"border-gray-900 bg-gray-50":"border-gray-300 bg-white"),children:(0,b.jsx)(A.default,{className:"text-gray-900 text-xl font-bold",children:i[t]})},t)),(0,b.jsx)(Fe.default,{ref:j,value:i,onChangeText:e=>{const t=e.replace(/[^0-9]/g,"");t.length<=6&&u(t)},maxLength:6,keyboardType:"number-pad",caretHidden:!0,selectionColor:"transparent",style:{position:"absolute",width:"100%",height:"100%",opacity:0,fontSize:1},autoFocus:!0})]}),(0,b.jsx)(o.default,{className:"mb-10",children:y?(0,b.jsx)(D.default,{onPress:async()=>{m(!0);try{await g.post("/users/resend-otp/",{email:s}),x(60),w(!1),C.default.alert("Success","OTP has been resent to your email.")}catch(e){C.default.alert("Error","Failed to resend OTP. Try again later.")}finally{m(!1)}},children:(0,b.jsx)(A.default,{className:"text-blue-600 font-bold text-base",children:"Resend Code"})}):(0,b.jsxs)(A.default,{className:"text-gray-400 text-base",children:["Resend Code in ",(0,b.jsxs)(A.default,{className:"text-gray-600 font-medium",children:[h,"s"]})]})}),(0,b.jsx)(D.default,{onPress:async()=>{if(console.log("OTPScreen: handleVerify pressed",{otp:i,email:s}),!i||i.length<6)C.default.alert("Invalid OTP","Please enter a valid 6-digit OTP.");else{m(!0);try{console.log("OTPScreen: Sending verification request...");const e=await g.post("/users/otp-verify/",{id:n,otp:i,key:l});console.log("OTPScreen: Verification successful",e.data),200!==e.status&&201!==e.status||("New User"===c?(console.log("New User verified. Navigate to ProcessForm."),t.replace("ProcessForm",{email:s,id:n})):await a())}catch(e){console.error("OTPScreen: Verification error",e);const t=e.response?.data?.error||"Verification failed.";C.default.alert("Error",t),u(""),j.current?.focus()}finally{m(!1)}}},disabled:f,className:"w-full py-4 rounded-xl items-center shadow-sm "+(f?"bg-gray-400":"bg-gray-900"),children:(0,b.jsx)(A.default,{className:"text-white font-bold text-lg tracking-wide",children:f?"Verifying...":"Verify"})})]})]})]})})},it=()=>{(0,r.useNavigation)();const e=(0,r.useRoute)(),{checkAuth:t}=p(),{status:a="Manual",email:s,id:l}=e.params||{},[c,i]=(0,d.useState)(1),[u,f]=(0,d.useState)(!1),[m,h]=(0,d.useState)({firstName:"",lastName:"",phone:""}),[x,y]=(0,d.useState)({}),w=()=>{let e={};return 1===c?(m.firstName||(e.firstName="First name is required"),m.lastName||(e.lastName="Last name is required")):2===c&&(m.phone||(e.phone="Phone number is required"),m.phone.length<10&&(e.phone="Enter a valid phone number")),y(e),0===Object.keys(e).length},j=async()=>{f(!0),y({});const e={id:l,first_name:"Google"===a?null:m.firstName,last_name:"Google"===a?null:m.lastName,mobile_number:m.phone.startsWith("+91")?m.phone:`+91${m.phone}`,profile_pic:null};try{console.log("ProcessForm: Submitting...",e);const a=await g.post("/users/SetUsersDetail/",e);console.log("Saved user details:",a.data),i(e=>e+1),setTimeout(async()=>{await t()},2e3)}catch(s){console.error("Save failed:",s),s.response&&(console.log("Save Error Data:",JSON.stringify(s.response.data,null,2)),console.log("Save Error Status:",s.response.status));const e=s.response?.data?.detail||"Failed to save details. Try again.";C.default.alert("Error",e)}finally{f(!1)}};return(0,b.jsx)(O.SafeAreaView,{className:"flex-1 bg-white",children:(0,b.jsxs)(Me.default,{behavior:"height",className:"flex-1",children:[(0,b.jsx)(o.default,{className:"flex-row items-center p-4",children:c>1&&c<4&&"Google"!==a?(0,b.jsx)(D.default,{onPress:()=>{i(c-1)},className:"p-2 bg-gray-50 rounded-full",children:(0,b.jsx)(I.default,{name:"arrow-back",size:24,color:"black"})}):(0,b.jsx)(o.default,{className:"w-10"})}),(0,b.jsxs)(Oe.default,{contentContainerStyle:{flexGrow:1,paddingHorizontal:24,paddingBottom:40},children:["Google"!==a&&c<=3&&(0,b.jsx)(({currentStep:e})=>(0,b.jsx)(o.default,{className:"mb-10 px-4",children:(0,b.jsxs)(o.default,{className:"flex-row justify-between items-center relative",children:[(0,b.jsx)(o.default,{className:"absolute left-0 right-0 h-1 bg-gray-100 rounded-full top-[14px]"}),["Personal","Contact","Review"].map((t,a)=>{const s=e>=a+1;return(0,b.jsxs)(o.default,{className:"items-center z-10 w-20",children:[(0,b.jsx)(o.default,{className:"w-8 h-8 items-center justify-center rounded-full border-4 "+(s?"bg-gray-900 border-gray-900":"bg-white border-gray-200"),children:s?(0,b.jsx)(o.default,{className:"w-2 h-2 rounded-full bg-white"}):null}),(0,b.jsx)(A.default,{className:"mt-2 text-[10px] font-bold uppercase tracking-wider "+(s?"text-gray-900":"text-gray-300"),children:t})]},a)})]})}),{currentStep:c}),(0,b.jsx)(o.default,{className:"flex-1 justify-center",children:(()=>{if(4===c)return(0,b.jsxs)(o.default,{className:"items-center justify-center py-10",children:[(0,b.jsx)(o.default,{className:"w-24 h-24 bg-green-50 rounded-full items-center justify-center mb-6",children:(0,b.jsx)(I.default,{name:"checkmark-sharp",size:48,color:"#16a34a"})}),(0,b.jsx)(A.default,{className:"text-3xl font-bold text-gray-900 mb-2",children:"All Set!"}),(0,b.jsx)(A.default,{className:"text-gray-500 text-center px-8",children:"Your profile has been created successfully. Taking you to the dashboard..."}),(0,b.jsx)(n.default,{size:"large",color:"#111827",className:"mt-8"})]});if("Google"===a)return(0,b.jsxs)(o.default,{className:"space-y-6 pt-4",children:[(0,b.jsxs)(o.default,{className:"items-center mb-4",children:[(0,b.jsx)(o.default,{className:"w-16 h-16 bg-blue-50 rounded-full items-center justify-center mb-4",children:(0,b.jsx)(I.default,{name:"phone-portrait-outline",size:32,color:"#2563eb"})}),(0,b.jsx)(A.default,{className:"text-2xl font-bold text-gray-900 text-center",children:"One Last Thing"}),(0,b.jsx)(A.default,{className:"text-gray-500 text-center px-6",children:"We need your mobile number to connect you with mechanics nearby."})]}),(0,b.jsxs)(o.default,{children:[(0,b.jsx)(A.default,{className:"text-xs font-bold text-gray-900 uppercase tracking-wider mb-2 ml-1",children:"Phone Number"}),(0,b.jsxs)(o.default,{className:"flex-row items-center border border-gray-200 rounded-xl bg-gray-50 focus:border-gray-900 focus:bg-white overflow-hidden h-14",children:[(0,b.jsx)(o.default,{className:"pl-4 pr-3 border-r border-gray-200 h-full justify-center items-center bg-gray-100",children:(0,b.jsx)(A.default,{className:"text-gray-500 font-bold",children:"+91"})}),(0,b.jsx)(Fe.default,{value:m.phone,onChangeText:e=>{const t=e.replace(/[^0-9]/g,"");t.length<=10&&h(Object.assign({},m,{phone:t}))},placeholder:"98765 43210",placeholderTextColor:"#9ca3af",keyboardType:"number-pad",maxLength:10,className:"flex-1 px-4 text-lg text-gray-900 font-medium h-full"})]}),x.phone&&(0,b.jsx)(A.default,{className:"text-red-500 text-sm mt-1 ml-1",children:x.phone})]}),(0,b.jsx)(D.default,{onPress:j,disabled:u,className:"w-full py-4 bg-gray-900 rounded-xl items-center shadow-lg shadow-gray-200 mt-4 active:scale-95 transition-transform",children:u?(0,b.jsx)(n.default,{color:"#fff"}):(0,b.jsx)(A.default,{className:"text-white font-bold text-lg",children:"Complete Setup"})})]});switch(c){case 1:return(0,b.jsxs)(o.default,{className:"space-y-6",children:[(0,b.jsxs)(o.default,{className:"items-center mb-4",children:[(0,b.jsx)(A.default,{className:"text-2xl font-bold text-gray-900",children:"Personal Details"}),(0,b.jsx)(A.default,{className:"text-gray-500",children:"Let's get to know you better"})]}),(0,b.jsxs)(o.default,{children:[(0,b.jsx)(A.default,{className:"text-xs font-bold text-gray-900 uppercase tracking-wider mb-2 ml-1",children:"First Name"}),(0,b.jsx)(Fe.default,{value:m.firstName,onChangeText:e=>h(Object.assign({},m,{firstName:e})),className:"w-full px-4 py-4 bg-gray-50 rounded-xl text-gray-900 border border-gray-200 focus:border-black focus:bg-white text-lg font-medium",placeholder:"e.g. Rahul",placeholderTextColor:"#9ca3af"}),x.firstName&&(0,b.jsx)(A.default,{className:"text-red-500 text-sm mt-1 ml-1",children:x.firstName})]}),(0,b.jsxs)(o.default,{children:[(0,b.jsx)(A.default,{className:"text-xs font-bold text-gray-900 uppercase tracking-wider mb-2 ml-1",children:"Last Name"}),(0,b.jsx)(Fe.default,{value:m.lastName,onChangeText:e=>h(Object.assign({},m,{lastName:e})),className:"w-full px-4 py-4 bg-gray-50 rounded-xl text-gray-900 border border-gray-200 focus:border-black focus:bg-white text-lg font-medium",placeholder:"e.g. Sharma",placeholderTextColor:"#9ca3af"}),x.lastName&&(0,b.jsx)(A.default,{className:"text-red-500 text-sm mt-1 ml-1",children:x.lastName})]})]});case 2:return(0,b.jsxs)(o.default,{className:"space-y-6",children:[(0,b.jsxs)(o.default,{className:"items-center mb-4",children:[(0,b.jsx)(A.default,{className:"text-2xl font-bold text-gray-900",children:"Contact"}),(0,b.jsx)(A.default,{className:"text-gray-500",children:"Your number is used for OTP verification"})]}),(0,b.jsxs)(o.default,{children:[(0,b.jsx)(A.default,{className:"text-xs font-bold text-gray-900 uppercase tracking-wider mb-2 ml-1",children:"Phone Number"}),(0,b.jsxs)(o.default,{className:"flex-row items-center border border-gray-200 rounded-xl bg-gray-50 focus:border-gray-900 focus:bg-white overflow-hidden h-14",children:[(0,b.jsx)(o.default,{className:"pl-4 pr-3 border-r border-gray-200 h-full justify-center items-center bg-gray-100",children:(0,b.jsx)(A.default,{className:"text-gray-500 font-bold",children:"+91"})}),(0,b.jsx)(Fe.default,{value:m.phone,onChangeText:e=>{const t=e.replace(/[^0-9]/g,"");t.length<=10&&h(Object.assign({},m,{phone:t}))},placeholder:"98765 43210",placeholderTextColor:"#9ca3af",keyboardType:"number-pad",maxLength:10,className:"flex-1 px-4 text-lg text-gray-900 font-medium h-full"})]}),x.phone&&(0,b.jsx)(A.default,{className:"text-red-500 text-sm mt-1 ml-1",children:x.phone})]})]});case 3:return(0,b.jsxs)(o.default,{children:[(0,b.jsxs)(o.default,{className:"items-center mb-6",children:[(0,b.jsx)(A.default,{className:"text-2xl font-bold text-gray-900",children:"Summary"}),(0,b.jsx)(A.default,{className:"text-gray-500",children:"Please review your details"})]}),(0,b.jsxs)(o.default,{className:"bg-white p-6 rounded-2xl space-y-6 border border-gray-100 shadow-md",children:[(0,b.jsxs)(o.default,{className:"flex-row items-center",children:[(0,b.jsx)(o.default,{className:"w-12 h-12 bg-blue-50 rounded-full items-center justify-center mr-4 border border-blue-100",children:(0,b.jsx)(I.default,{name:"person",size:20,color:"#2563eb"})}),(0,b.jsxs)(o.default,{children:[(0,b.jsx)(A.default,{className:"text-xs text-gray-400 uppercase font-bold tracking-wider mb-1",children:"Full Name"}),(0,b.jsxs)(A.default,{className:"text-gray-900 text-lg font-bold",children:[m.firstName," ",m.lastName]})]})]}),(0,b.jsxs)(o.default,{className:"flex-row items-center",children:[(0,b.jsx)(o.default,{className:"w-12 h-12 bg-green-50 rounded-full items-center justify-center mr-4 border border-green-100",children:(0,b.jsx)(I.default,{name:"call",size:20,color:"#16a34a"})}),(0,b.jsxs)(o.default,{children:[(0,b.jsx)(A.default,{className:"text-xs text-gray-400 uppercase font-bold tracking-wider mb-1",children:"Phone"}),(0,b.jsxs)(A.default,{className:"text-gray-900 text-lg font-bold",children:["+91 ",m.phone]})]})]})]})]});default:return null}})()}),c<4&&"Google"!==a&&(0,b.jsx)(o.default,{className:"mt-10",children:c<3?(0,b.jsx)(D.default,{onPress:()=>{w()&&i(c+1)},className:"w-full py-4 rounded-xl bg-gray-900 shadow-lg shadow-gray-200 items-center active:scale-95 transition-transform",children:(0,b.jsx)(A.default,{className:"text-white font-bold text-lg",children:"Continue"})}):(0,b.jsx)(D.default,{onPress:j,disabled:u,className:"w-full py-4 rounded-xl bg-gray-900 shadow-lg shadow-gray-200 items-center active:scale-95 transition-transform",children:u?(0,b.jsx)(n.default,{color:"#fff"}):(0,b.jsx)(A.default,{className:"text-white font-bold text-lg",children:"Create Account"})})})]})]})})},dt=({navigation:e})=>{const{logout:t,profile:a,checkAuth:s}=p(),[r,l]=(0,d.useState)([]),[c,i]=(0,d.useState)([]),[u,f]=(0,d.useState)(!0),[m,h]=(0,d.useState)(!1);(0,d.useEffect)(()=>{x()},[]);const x=async()=>{f(!0);try{await s(),await w()}finally{f(!1),h(!1)}},y=a||{},w=async()=>{try{const e=(await g.get("/Profile/UserHistory/")).data||[];e.sort((e,t)=>new Date(t.created_at)-new Date(e.created_at)),l(e),i(e.slice(0,10))}catch(e){console.error("History fetch error:",e)}},j=e=>{if(!e)return"";return new Date(e).toLocaleDateString("en-IN",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})};if(u&&!m)return(0,b.jsx)(O.SafeAreaView,{className:"flex-1 bg-white justify-center items-center",children:(0,b.jsx)(n.default,{size:"large",color:"#000"})});const N=y.first_name||"User",S=y.last_name||"",_=y.email||"No Email",v=y.mobile_number||"No Phone",P=(N[0]+(S[0]||"")).toUpperCase();return(0,b.jsxs)(O.SafeAreaView,{className:"flex-1 bg-white",children:[(0,b.jsxs)(o.default,{className:"flex-row items-center p-4 border-b border-gray-100 bg-white z-10",children:[(0,b.jsx)(D.default,{onPress:()=>e.goBack(),className:"p-2 absolute left-4 z-20",children:(0,b.jsx)(I.default,{name:"arrow-back",size:24,color:"black"})}),(0,b.jsx)(A.default,{className:"flex-1 text-center text-lg font-bold text-gray-900",children:"My Profile"})]}),(0,b.jsx)(Oe.default,{refreshControl:(0,b.jsx)(De.default,{refreshing:m,onRefresh:()=>{h(!0),x()}}),contentContainerStyle:{paddingBottom:40},showsVerticalScrollIndicator:!1,children:(0,b.jsxs)(o.default,{className:"p-6 pb-0",children:[(0,b.jsxs)(o.default,{className:"items-center mb-8",children:[(0,b.jsx)(o.default,{className:"w-28 h-28 rounded-full bg-gray-50 items-center justify-center mb-4 overflow-hidden border-4 border-white shadow-lg shadow-blue-100",children:y.profile_pic?(0,b.jsx)(Y.default,{source:{uri:y.profile_pic},className:"w-full h-full"}):(0,b.jsx)(A.default,{className:"text-3xl font-bold text-gray-400",children:P})}),(0,b.jsxs)(A.default,{className:"text-2xl font-bold text-gray-900",children:[N," ",S]}),(0,b.jsx)(A.default,{className:"text-gray-500 font-medium",children:_}),(0,b.jsx)(o.default,{className:"mt-2 px-3 py-1 bg-blue-50 rounded-full border border-blue-100",children:(0,b.jsx)(A.default,{className:"text-blue-600 text-xs font-bold",children:v})})]}),(0,b.jsxs)(o.default,{className:"flex-row justify-between bg-gray-900 rounded-2xl p-6 mb-8 shadow-xl shadow-gray-300",children:[(0,b.jsxs)(o.default,{className:"items-center flex-1 border-r border-gray-700",children:[(0,b.jsx)(A.default,{className:"text-white text-2xl font-bold",children:r.filter(e=>"COMPLETED"===e.status).length}),(0,b.jsx)(A.default,{className:"text-gray-400 text-xs uppercase tracking-wider mt-1",children:"Services"})]}),(0,b.jsxs)(o.default,{className:"items-center flex-1",children:[(0,b.jsx)(A.default,{className:"text-white text-2xl font-bold",children:r.length}),(0,b.jsx)(A.default,{className:"text-gray-400 text-xs uppercase tracking-wider mt-1",children:"Total"})]})]}),(0,b.jsxs)(o.default,{className:"mb-4",children:[(0,b.jsx)(A.default,{className:"text-xl font-bold text-gray-900 mb-4",children:"Service History"}),c.length>0?(0,b.jsxs)(b.Fragment,{children:[c.map(e=>{const t=(e=>{switch(e){case"COMPLETED":return"bg-green-100 text-green-700 border-green-500";case"CANCELLED":return"bg-red-100 text-red-700 border-red-500";case"EXPIRED":return"bg-gray-100 text-gray-700 border-gray-500";default:return"bg-gray-100 text-gray-700 border-gray-400"}})(e.status);e.status;return(0,b.jsxs)(o.default,{className:"bg-white rounded-2xl p-4 mb-4 shadow-sm border border-gray-100",children:[(0,b.jsxs)(o.default,{className:"flex-row justify-between items-start mb-2",children:[(0,b.jsxs)(o.default,{className:"flex-row items-center space-x-2",children:[(0,b.jsx)(o.default,{className:"p-2 rounded-full "+("COMPLETED"===e.status?"bg-green-50":"bg-red-50"),children:"car"===e.vehical_type?(0,b.jsx)(I.default,{name:"car-sport",size:20,color:"COMPLETED"===e.status?"#16a34a":"#ef4444"}):(0,b.jsx)(L.default,{name:"motorbike",size:20,color:"COMPLETED"===e.status?"#16a34a":"#ef4444"})}),(0,b.jsxs)(o.default,{children:[(0,b.jsx)(A.default,{className:"text-gray-900 font-bold text-base",children:e.problem}),(0,b.jsx)(A.default,{className:"text-xs text-gray-400",children:j(e.created_at)})]})]}),(0,b.jsx)(o.default,{className:`px-2 py-1 rounded-lg border ${t.split(" ")[2]} ${t.split(" ")[0]}`,children:(0,b.jsx)(A.default,{className:`text-xs font-bold ${t.split(" ")[1]}`,children:e.status})})]}),(0,b.jsxs)(o.default,{className:"mt-2 space-y-1",children:[(0,b.jsxs)(o.default,{className:"flex-row items-start",children:[(0,b.jsx)(I.default,{name:"location-sharp",size:14,color:"#9ca3af",style:{marginTop:2,marginRight:4}}),(0,b.jsx)(A.default,{className:"text-gray-500 text-sm flex-1",numberOfLines:2,children:e.location})]}),e.price&&(0,b.jsxs)(o.default,{className:"flex-row items-center mt-2",children:[(0,b.jsxs)(A.default,{className:"text-gray-900 font-bold text-lg",children:["\u20b9",e.price]}),(0,b.jsx)(A.default,{className:"text-gray-400 text-xs ml-1",children:" paid"})]}),"CANCELLED"===e.status&&e.cancellation_reason&&(0,b.jsxs)(A.default,{className:"text-red-400 text-xs mt-1 italic",children:["Reason: ",e.cancellation_reason]})]})]},e.id)}),c.length<r.length&&(0,b.jsx)(D.default,{onPress:()=>{const e=c.length,t=r.slice(e,e+10);t.length>0&&i(e=>[...e,...t])},className:"py-3 bg-gray-100 rounded-xl items-center mt-2 active:bg-gray-200",children:(0,b.jsx)(A.default,{className:"text-gray-600 font-bold text-sm",children:"Load More"})})]}):(0,b.jsxs)(o.default,{className:"items-center py-10 bg-gray-50 rounded-xl border-dashed border-2 border-gray-200",children:[(0,b.jsx)(I.default,{name:"document-text-outline",size:40,color:"#d1d5db"}),(0,b.jsx)(A.default,{className:"text-gray-400 mt-2",children:"No service history found"})]})]}),(0,b.jsx)(o.default,{className:"space-y-3 pt-4 border-t border-gray-100",children:(0,b.jsx)(D.default,{onPress:t,className:"flex-row items-center justify-center py-4 bg-red-50 rounded-xl",children:(0,b.jsx)(A.default,{className:"text-red-500 font-bold text-lg",children:"Logout"})})})]})})]})};var ut=a(9149),ft=a(5163);const{width:mt,height:ht}=z.default.get("window"),xt=[{id:"bike",name:"Bike / Scooter",icon:"motorbike",library:L.default},{id:"car",name:"Car / Sedan",icon:"car-side",library:L.default},{id:"truck",name:"Truck / SUV",icon:"truck",library:L.default}],gt={bike:[{name:"Puncture Repair",icon:"wrench"},{name:"Air Fill-up",icon:"air"},{name:"Chain Repair",icon:"link"},{name:"Spark Plug Issue",icon:"flash"},{name:"Fuel Delivery",icon:"water"},{name:"Key Issue",icon:"key"},{name:"General Checkup",icon:"search"},{name:"Other",icon:"help-circle"}],car:[{name:"Puncture Repair",icon:"wrench"},{name:"Air Fill-up",icon:"air"},{name:"Battery Jumpstart",icon:"battery-charging"},{name:"Tire Replacement",icon:"settings"},{name:"Fuel Delivery",icon:"water"},{name:"Key Lockout",icon:"key"},{name:"Engine Overheat",icon:"thermometer"},{name:"Other",icon:"help-circle"}],truck:[{name:"Puncture Repair",icon:"wrench"},{name:"Air Fill-up",icon:"air"},{name:"Battery Jumpstart",icon:"battery-charging"},{name:"Tire Replacement",icon:"settings"},{name:"Fuel Delivery",icon:"water"},{name:"Engine Issue",icon:"cog"},{name:"Other",icon:"help-circle"}]},bt="punctureRequestFormData";function yt(){const e=(0,r.useNavigation)(),[t,a]=(0,d.useState)(1),[s,l]=(0,d.useState)(!1),[u,f]=(0,d.useState)(!1),[m,h]=(0,d.useState)(!1),[x,y]=(0,d.useState)(null),p=(0,d.useRef)(null),[w,j]=(0,d.useState)({vehicleType:"",location:"Selecting location...",latitude:23.0225,longitude:72.5714,problem:"",additionalNotes:""}),[N,S]=(0,d.useState)([]),[_,v]=(0,d.useState)(null);(0,d.useEffect)(()=>{(async()=>{const e=await ie();S(e)})()},[]);const[P,k]=(0,d.useState)({latitude:23.0225,longitude:72.5714,latitudeDelta:.005,longitudeDelta:.005});(0,d.useEffect)(()=>{(async()=>{try{const e=await i.getItemAsync(bt);e&&(j(JSON.parse(e)),console.log("[ServiceRequest] Loaded saved drafts."))}catch(e){console.warn("Failed to load drafts",e)}})()},[]),(0,d.useEffect)(()=>{const e=setTimeout(()=>{i.setItemAsync(bt,JSON.stringify(w))},500);return()=>clearTimeout(e)},[w]);const T=()=>1===t?!!w.vehicleType:2===t||(3===t?!!w.problem:4===t||5===t);(0,d.useEffect)(()=>{2===t&&C()},[t]);const E=async(e,t)=>{try{const a=await F.reverseGeocodeAsync({latitude:e,longitude:t});if(a&&a.length>0){const e=a[0];return[e.name,e.street,e.subregion,e.city,e.postalCode].filter(Boolean).join(", ")}}catch(a){console.warn("Reverse geocoding failed",a)}return`Lat: ${e.toFixed(4)}, Lng: ${t.toFixed(4)}`},C=async()=>{j(e=>Object.assign({},e,{location:"Fetching current location..."}));try{let{status:e}=await F.requestForegroundPermissionsAsync();if("granted"!==e)return void alert("Permission denied");let t=await F.getCurrentPositionAsync({accuracy:ft.LocationAccuracy.Balanced});const{latitude:a,longitude:s}=t.coords,r=await E(a,s),l={latitude:a,longitude:s,latitudeDelta:.005,longitudeDelta:.005};j(e=>Object.assign({},e,{latitude:a,longitude:s,location:r})),k(l),p.current&&p.current.animateToRegion(l,1e3)}catch(e){console.error(e),j(e=>Object.assign({},e,{location:"Location unavailable"}))}};return(0,b.jsxs)(O.SafeAreaView,{className:"flex-1 bg-white",children:[(0,b.jsx)(V.default,{barStyle:"dark-content"}),m&&(0,b.jsxs)(c.default.View,{entering:c.FadeIn,className:"absolute top-0 left-0 right-0 bottom-0 bg-white z-50 items-center justify-center px-6",children:[(0,b.jsx)(c.default.View,{entering:c.ZoomIn.delay(200),className:"w-32 h-32 bg-green-600 rounded-full items-center justify-center mb-8 shadow-xl shadow-green-200",children:(0,b.jsx)(I.default,{name:"checkmark",size:64,color:"white"})}),(0,b.jsx)(c.default.Text,{entering:c.FadeIn.delay(400),className:"text-2xl font-black text-gray-900 mb-2 tracking-wider uppercase text-center",children:"Request Submitted"}),(0,b.jsx)(c.default.Text,{entering:c.FadeIn.delay(600),className:"text-gray-500 font-medium text-center mb-8 text-base",children:"Notifying mechanics near you..."}),(0,b.jsxs)(c.default.View,{entering:c.FadeIn.delay(800),className:"bg-gray-50 p-6 rounded-2xl w-full items-center border border-gray-100",children:[(0,b.jsx)(A.default,{className:"text-xs font-bold text-gray-400 uppercase mb-2",children:"Service Location"}),(0,b.jsx)(A.default,{className:"text-gray-900 font-bold text-lg text-center leading-6",children:w.location})]})]}),(0,b.jsx)(o.default,{className:"bg-white px-4 pb-4 border-b border-gray-100 pt-2",children:(0,b.jsxs)(o.default,{className:"flex-row items-center",children:[(0,b.jsx)(D.default,{onPress:()=>t>1?void(t>1&&a(t-1)):e.goBack(),className:"p-2 bg-gray-50 rounded-full mr-4",children:(0,b.jsx)(I.default,{name:"arrow-back",size:24,color:"#1f2937"})}),(0,b.jsxs)(o.default,{className:"flex-1 flex-row items-center",children:[(0,b.jsxs)(o.default,{className:"flex-1 h-2 bg-gray-100 rounded-full overflow-hidden flex-row mr-3",children:[(0,b.jsx)(o.default,{className:"h-full bg-blue-500 transition-all duration-300 "+(t>=1?"w-[20%]":"w-0")}),(0,b.jsx)(o.default,{className:"h-full bg-blue-500 transition-all duration-300 "+(t>=2?"w-[20%]":"w-0")}),(0,b.jsx)(o.default,{className:"h-full bg-blue-500 transition-all duration-300 "+(t>=3?"w-[20%]":"w-0")}),(0,b.jsx)(o.default,{className:"h-full bg-blue-500 transition-all duration-300 "+(t>=4?"w-[20%]":"w-0")}),(0,b.jsx)(o.default,{className:"h-full bg-blue-500 transition-all duration-300 "+(t>=5?"w-[20%]":"w-0")})]}),(0,b.jsxs)(A.default,{className:"text-gray-400 font-bold text-xs",children:["Step ",t,"/5"]})]})]})}),(0,b.jsxs)(o.default,{className:"flex-1 bg-white mb-3",children:[1===t&&(0,b.jsxs)(c.default.View,{entering:c.SlideInRight,exiting:c.SlideOutLeft,className:"flex-1 px-4 pt-4",children:[(0,b.jsx)(A.default,{className:"text-2xl font-bold text-gray-900 mb-2",children:"Select Vehicle"}),(0,b.jsx)(A.default,{className:"text-gray-500 mb-6",children:"Choose the vehicle you need help with."}),(0,b.jsx)(o.default,{className:"flex-row flex-wrap justify-between",children:xt.map(e=>{const t=w.vehicleType===e.id;return(0,b.jsxs)(D.default,{onPress:()=>j(Object.assign({},w,{vehicleType:e.id,problem:""})),className:"w-[48%] mb-4 p-4 rounded-2xl border-2 items-center justify-center h-40 shadow-sm "+(t?"bg-blue-50 border-blue-500":"bg-white border-gray-100"),children:[(0,b.jsx)(e.library,{name:e.icon,size:48,color:t?"#3b82f6":"#9ca3af"}),(0,b.jsx)(A.default,{className:"mt-4 font-bold "+(t?"text-blue-700":"text-gray-600"),children:e.name}),t&&(0,b.jsx)(o.default,{className:"absolute top-3 right-3 bg-blue-500 rounded-full p-1",children:(0,b.jsx)(I.default,{name:"checkmark",size:12,color:"white"})})]},e.id)})})]}),2===t&&(0,b.jsxs)(c.default.View,{entering:c.SlideInRight,exiting:c.SlideOutLeft,className:"flex-1 bg-gray-50",children:[(0,b.jsxs)(le,{ref:p,provider:ne,style:{flex:1},region:P,onRegionChangeComplete:async e=>{k(e);const t=await E(e.latitude,e.longitude);j(a=>Object.assign({},a,{latitude:e.latitude,longitude:e.longitude,location:t}))},children:[(0,b.jsx)(ae,{coordinate:{latitude:w.latitude,longitude:w.longitude},opacity:0}),N.map(e=>(0,b.jsx)(ae,{coordinate:{latitude:e.latitude,longitude:e.longitude},onPress:()=>v(e),children:(0,b.jsx)(o.default,{className:"bg-white p-0.5 rounded-full border-2 border-amber-400 shadow-lg overflow-hidden",style:{width:36,height:36},children:(0,b.jsx)(Y.default,{source:{uri:e.logo},className:"w-full h-full rounded-full",resizeMode:"cover"})})},`ad-${e.id}`))]}),(0,b.jsxs)(o.default,{pointerEvents:"none",className:"absolute top-0 bottom-0 left-0 right-0 flex items-center justify-center",children:[(0,b.jsx)(o.default,{className:"w-8 h-8 bg-blue-400/30 rounded-full flex items-center justify-center",children:(0,b.jsx)(o.default,{className:"w-6 h-6 bg-blue-600/80 rounded-full flex items-center justify-center",children:(0,b.jsx)(o.default,{className:"w-4 h-4 bg-blue-800 rounded-full"})})}),(0,b.jsx)(o.default,{className:"w-1 h-1 bg-black/20 rounded-full mt-1"})]}),(0,b.jsx)(D.default,{onPress:C,className:"absolute bottom-80 right-6 bg-white p-3 rounded-full shadow-lg border border-gray-100",children:(0,b.jsx)(ut.default,{name:"my-location",size:24,color:"#3b82f6"})}),(0,b.jsxs)(o.default,{className:"absolute bottom-0 left-0 right-0 bg-white rounded-t-3xl p-6 shadow-2xl",children:[(0,b.jsx)(A.default,{className:"text-gray-400 text-xs font-bold uppercase tracking-wide mb-1",children:"Confirm Location"}),(0,b.jsx)(A.default,{className:"text-lg font-bold text-gray-900 mb-4",numberOfLines:1,children:"Identifying location..."===w.location?"...":w.location}),(0,b.jsxs)(o.default,{className:"flex-row items-center space-x-2 bg-blue-50 p-3 rounded-xl",children:[(0,b.jsx)(I.default,{name:"information-circle",size:20,color:"#3b82f6"}),(0,b.jsx)(A.default,{className:"text-blue-700 text-xs flex-1",children:"Move the map to center the pin at your location."})]})]})]}),3===t&&(0,b.jsxs)(c.default.View,{entering:c.SlideInRight,exiting:c.SlideOutLeft,className:"flex-1 px-4 pt-4",children:[(0,b.jsx)(A.default,{className:"text-2xl font-bold text-gray-900 mb-2",children:"Service Type"}),(0,b.jsx)(A.default,{className:"text-gray-500 mb-6",children:"What seems to be the problem?"}),(0,b.jsx)(Oe.default,{showsVerticalScrollIndicator:!1,contentContainerStyle:{paddingBottom:100},children:(0,b.jsx)(o.default,{className:"flex-row flex-wrap justify-between",children:gt[w.vehicleType||"car"]?.map((e,t)=>{const a=w.problem===e.name;let s="construct";return"air"===e.icon&&(s="bicycle"),"battery-charging"===e.icon&&(s="battery-charging"),"settings"===e.icon&&(s="cog"),"key"===e.icon&&(s="key"),"water"===e.icon&&(s="water"),"flash"===e.icon&&(s="flash"),"search"===e.icon&&(s="search"),"thermometer"===e.icon&&(s="thermometer"),"help-circle"===e.icon&&(s="help-circle"),(0,b.jsxs)(D.default,{onPress:()=>j(Object.assign({},w,{problem:e.name})),className:"w-[48%] mb-4 p-4 rounded-2xl border items-center justify-center h-32 active:scale-95 transition-transform "+(a?"bg-blue-50 border-blue-500 shadow-md":"bg-white border-gray-100 shadow-sm"),children:[(0,b.jsx)(I.default,{name:s,size:32,color:a?"#3b82f6":"#6b7280"}),(0,b.jsx)(A.default,{className:"mt-3 font-semibold text-center "+(a?"text-blue-700 font-bold":"text-gray-600"),children:e.name})]},t)})})})]}),4===t&&(0,b.jsxs)(c.default.View,{entering:c.SlideInRight,exiting:c.SlideOutLeft,className:"flex-1 px-4 pt-4",children:[(0,b.jsx)(A.default,{className:"text-2xl font-bold text-gray-900 mb-2",children:"Additional Details"}),(0,b.jsx)(A.default,{className:"text-gray-500 mb-6",children:"Describe the issue in more detail (Optional)."}),(0,b.jsx)(o.default,{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-4",children:(0,b.jsx)(Fe.default,{className:"text-gray-800 text-lg h-40 text-top align-top",multiline:!0,placeholder:"e.g. My car stopped suddenly, there is a weird noise coming from the engine...",placeholderTextColor:"#9ca3af",value:w.additionalNotes,onChangeText:e=>j(Object.assign({},w,{additionalNotes:e})),autoFocus:!0})})]}),5===t&&(0,b.jsxs)(c.default.View,{entering:c.SlideInRight,exiting:c.SlideOutLeft,className:"flex-1 px-4 pt-4",children:[(0,b.jsx)(A.default,{className:"text-2xl font-bold text-gray-900 mb-2",children:"Review Request"}),(0,b.jsx)(A.default,{className:"text-gray-500 mb-6",children:"Please review details before submitting."}),(0,b.jsxs)(Oe.default,{showsVerticalScrollIndicator:!1,contentContainerStyle:{paddingBottom:100},children:[(0,b.jsxs)(o.default,{className:"bg-white rounded-2xl p-5 mb-4 shadow-sm border border-gray-100",children:[(0,b.jsxs)(o.default,{className:"flex-row items-center border-b border-gray-50 pb-4 mb-4",children:[(0,b.jsx)(o.default,{className:"w-12 h-12 bg-blue-50 rounded-full items-center justify-center mr-4",children:(()=>{const e=xt.find(e=>e.id===w.vehicleType);return e?(0,b.jsx)(e.library,{name:e.icon,size:24,color:"#2563eb"}):(0,b.jsx)(I.default,{name:"car",size:24,color:"#2563eb"})})()}),(0,b.jsxs)(o.default,{children:[(0,b.jsx)(A.default,{className:"text-gray-500 text-xs uppercase tracking-wider font-bold",children:"Vehicle Type"}),(0,b.jsx)(A.default,{className:"text-gray-900 font-bold text-lg capitalize",children:w.vehicleType})]})]}),(0,b.jsxs)(o.default,{children:[(0,b.jsx)(A.default,{className:"text-gray-500 text-xs uppercase tracking-wider font-bold mb-1",children:"Problem"}),(0,b.jsx)(A.default,{className:"text-gray-900 font-bold text-lg",children:w.problem})]})]}),(0,b.jsxs)(o.default,{className:"bg-white rounded-2xl p-5 mb-4 shadow-sm border border-gray-100",children:[(0,b.jsxs)(o.default,{className:"flex-row items-start",children:[(0,b.jsx)(I.default,{name:"location",size:24,color:"#ef4444",style:{marginTop:2,marginRight:12}}),(0,b.jsxs)(o.default,{className:"flex-1",children:[(0,b.jsx)(A.default,{className:"text-gray-500 text-xs uppercase tracking-wider font-bold mb-1",children:"Pick-up Location"}),(0,b.jsx)(A.default,{className:"text-gray-900 font-medium leading-6",children:w.location})]})]}),(0,b.jsxs)(o.default,{className:"mt-4 pt-4 border-t border-gray-50 flex-row justify-between",children:[(0,b.jsxs)(A.default,{className:"text-gray-400 text-xs",children:["Lat: ",w.latitude.toFixed(4)]}),(0,b.jsxs)(A.default,{className:"text-gray-400 text-xs",children:["Lng: ",w.longitude.toFixed(4)]})]})]}),(0,b.jsx)(o.default,{className:"bg-white rounded-2xl p-5 mb-4 shadow-sm border border-gray-100",children:(0,b.jsxs)(o.default,{className:"flex-row items-start",children:[(0,b.jsx)(I.default,{name:"create",size:24,color:"#6b7280",style:{marginTop:2,marginRight:12}}),(0,b.jsxs)(o.default,{className:"flex-1",children:[(0,b.jsx)(A.default,{className:"text-gray-500 text-xs uppercase tracking-wider font-bold mb-1",children:"Additional Notes"}),(0,b.jsx)(A.default,{className:"text-gray-900 italic",children:w.additionalNotes?w.additionalNotes:"No additional details provided."})]})]})})]})]})]}),(0,b.jsx)(Me.default,{behavior:void 0,children:(0,b.jsx)(o.default,{className:"p-4 border-t border-gray-100 bg-white shadow-[0_-5px_15px_rgba(0,0,0,0.05)] z-20",children:(0,b.jsx)(D.default,{onPress:5===t?async()=>{l(!0);try{console.log("Submitting Request:",w);const t=await g.post("/jobs/CreateServiceRequest/",{latitude:w.latitude,longitude:w.longitude,location:w.location||"Custom Pin Location",vehical_type:w.vehicleType,problem:w.problem,additional_details:w.additionalNotes});console.log("Response:",t.data),y(t.data),l(!1),h(!0),setTimeout(()=>{e.navigate("FindingMechanic",{requestId:t.data.request_id,latitude:w.latitude,longitude:w.longitude,vehicleType:w.vehicleType,problem:w.problem}),setTimeout(()=>h(!1),500)},2500)}catch(t){console.error("Submission error:",t),alert("Failed to submit request. Please try again."),l(!1)}}:()=>{T()&&a(t+1)},disabled:!T()||s,className:"w-full py-4 rounded-2xl flex-row items-center justify-center shadow-lg active:scale-[0.98] "+(T()?"bg-blue-600 shadow-blue-200":"bg-gray-300 shadow-transparent"),children:s?(0,b.jsx)(n.default,{color:"white"}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(A.default,{className:"text-white font-bold text-lg mr-2",children:5===t?"Submit Request":"Next Step"}),(0,b.jsx)(I.default,{name:"arrow-forward",size:20,color:"white"})]})})})})]})}const pt=JSON.parse('{"expo":{"name":"Mechanic Setu","slug":"mechanic-setu","version":"1.0.6","orientation":"portrait","icon":"./assets/logo-optimized.png","scheme":"mechanicsetu","userInterfaceStyle":"automatic","newArchEnabled":true,"ios":{"supportsTablet":true,"config":{"googleMapsApiKey":"AIzaSyB41DRUbKW4nM5UPKsNHEMhhPcSilNv3I"},"bundleIdentifier":"com.anonymous.mechanicsetu"},"android":{"permissions":["VIBRATE","RECEIVE_BOOT_COMPLETED","POST_NOTIFICATIONS"],"config":{"googleMaps":{"apiKey":"AIzaSyB41DRUbKW4nM5UPKsNHEMhhPcSilNv3I"}},"adaptiveIcon":{"backgroundColor":"#E6F4FE","foregroundImage":"./assets/logo-optimized.png","backgroundImage":"./assets/logo-optimized.png","monochromeImage":"./assets/logo-optimized.png"},"edgeToEdgeEnabled":true,"predictiveBackGestureEnabled":false,"package":"com.anonymous.mechanicsetu"},"web":{"output":"static","favicon":"./assets/logo-optimized.png","bundler":"webpack","name":"Mechanic Setu","shortName":"Mechanic Setu","description":"On-demand mechanic services at your location","themeColor":"#10b981","backgroundColor":"#ffffff","display":"standalone","orientation":"portrait","startUrl":"/","scope":"/","lang":"en","splash":{"image":"./assets/logo-optimized.png","backgroundColor":"#ffffff","resizeMode":"contain"}},"plugins":[["expo-splash-screen",{"image":"./assets/logo-optimized.png","borderRadius":10,"backgroundColor":"#ffffff"}],["expo-notifications",{"icon":"./assets/logo-optimized.png","color":"#10b981","mode":"production"}]],"notification":{"icon":"./assets/logo-optimized.png","color":"#10b981","androidMode":"default","androidCollapsedTitle":"Mechanic Setu"},"extra":{"eas":{"projectId":"27756afd-dd20-446f-848e-203760ffef63"}}}}'),wt=({navigation:e})=>{const{logout:t,profile:a}=p(),s=pt?.expo?.version||"1.0.0",r=({icon:e,label:t,onPress:a,color:s="#374151"})=>(0,b.jsxs)(D.default,{onPress:a,className:"flex-row items-center justify-between p-2 mb-2 border-y border-gray-100",children:[(0,b.jsxs)(o.default,{className:"flex-row items-center space-x-3",children:[(0,b.jsx)(o.default,{className:" p-2 ",children:(0,b.jsx)(I.default,{name:e,size:20,color:s})}),(0,b.jsx)(A.default,{className:"text-gray-700 font-medium text-base ml-3",children:t})]}),(0,b.jsx)(I.default,{name:"chevron-forward",size:20,color:"#9ca3af"})]});return(0,b.jsxs)(O.SafeAreaView,{className:"flex-1 bg-white",children:[(0,b.jsx)(V.default,{barStyle:"dark-content"}),(0,b.jsx)(o.default,{className:"bg-white px-4 pb-4 border-b border-gray-200 pt-2",children:(0,b.jsxs)(o.default,{className:"flex-row items-center",children:[(0,b.jsx)(D.default,{onPress:()=>e.goBack(),className:"p-2 bg-gray-100 rounded-full mr-4",children:(0,b.jsx)(I.default,{name:"arrow-back",size:24,color:"#374151"})}),(0,b.jsx)(A.default,{className:"text-2xl font-bold text-gray-900",children:"Settings"})]})}),(0,b.jsxs)(Oe.default,{className:"flex-1 px-4 pt-6",showsVerticalScrollIndicator:!1,children:[(0,b.jsx)(A.default,{className:"text-xs font-bold text-gray-400 uppercase tracking-widest mb-3 ml-1",children:"Account"}),(0,b.jsx)(r,{icon:"person",label:"My Profile",onPress:()=>e.navigate("Profile"),color:"#2563eb"}),(0,b.jsx)(r,{icon:"construct",label:"Request Service",onPress:()=>e.navigate("ServiceRequest"),color:"#f59e0b"}),(0,b.jsx)(A.default,{className:"text-xs font-bold text-gray-400 uppercase tracking-widest mb-3 mt-4 ml-1",children:"Maintenance"}),(0,b.jsx)(r,{icon:"trash-outline",label:"Clear Cache & Data",onPress:async()=>{C.default.alert("Clear App Data","This will clear the active service card and any drafts. You will stay logged in.",[{text:"Cancel",style:"cancel"},{text:"Clear Data",style:"destructive",onPress:async()=>{try{await i.deleteItemAsync("mechanicAcceptedData"),await i.deleteItemAsync("punctureRequestFormData"),C.default.alert("Success","Local data cleared. Return to Dashboard to refresh.")}catch(e){C.default.alert("Error","Failed to clear data.")}}}])},color:"#ef4444"}),(0,b.jsx)(A.default,{className:"text-xs font-bold text-gray-400 uppercase tracking-widest mb-3 mt-4 ml-1",children:"Legal & Support"}),(0,b.jsx)(r,{icon:"document-text",label:"Terms & Conditions",onPress:()=>e.navigate("Legal",{type:"terms",title:"Terms & Conditions"})}),(0,b.jsx)(r,{icon:"shield-checkmark",label:"Privacy Policy",onPress:()=>e.navigate("Legal",{type:"privacy",title:"Privacy Policy"})}),(0,b.jsx)(r,{icon:"information-circle",label:"About Us",onPress:()=>e.navigate("Legal",{type:"about",title:"About Us"})}),(0,b.jsx)(A.default,{className:"text-xs font-bold text-gray-400 uppercase tracking-widest mb-3 mt-4 ml-1",children:"App"}),(0,b.jsx)(D.default,{onPress:t,className:"flex-row items-center justify-between p-4 bg-red-50 rounded-xl mb-3 border border-red-100",children:(0,b.jsxs)(o.default,{className:"flex-row items-center space-x-3",children:[(0,b.jsx)(o.default,{className:"bg-white p-2 rounded-full shadow-sm",children:(0,b.jsx)(I.default,{name:"log-out",size:20,color:"#dc2626"})}),(0,b.jsx)(A.default,{className:"text-red-600 font-medium text-base ml-3",children:"Logout"})]})}),(0,b.jsxs)(o.default,{className:"items-center mt-6 mb-10",children:[(0,b.jsxs)(A.default,{className:"text-gray-400 text-sm",children:["Version ",s]}),(0,b.jsx)(A.default,{className:"text-gray-300 text-xs mt-1",children:"Mechanic Setu \xa9 2025"})]})]})]})};var jt=a(8833);(0,c.configureReanimatedLogger)({level:c.ReanimatedLogLevel.warn,strict:!1});const Nt=(0,l.createNativeStackNavigator)(),St=()=>{const{isAuthenticated:e}=p();return null===e?(0,b.jsx)(o.default,{className:"flex-1 justify-center items-center bg-gray-900",children:(0,b.jsx)(n.default,{size:"large",color:"#2563eb"})}):(0,b.jsx)(r.NavigationContainer,{ref:k,children:(0,b.jsx)(Nt.Navigator,{screenOptions:{headerShown:!1},children:e?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(Nt.Screen,{name:"Main",component:be}),(0,b.jsx)(Nt.Screen,{name:"Profile",component:dt}),(0,b.jsx)(Nt.Screen,{name:"History",component:Re}),(0,b.jsx)(Nt.Screen,{name:"ServiceRequest",component:yt}),(0,b.jsx)(Nt.Screen,{name:"FindingMechanic",component:Ae}),(0,b.jsx)(Nt.Screen,{name:"MechanicFound",component:nt}),(0,b.jsx)(Nt.Screen,{name:"Cancellation",component:R}),(0,b.jsx)(Nt.Screen,{name:"Settings",component:wt}),(0,b.jsx)(Nt.Screen,{name:"NearbyMechanics",component:ot}),(0,b.jsx)(Nt.Screen,{name:"Legal",component:Ie})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(Nt.Screen,{name:"Login",component:ze}),(0,b.jsx)(Nt.Screen,{name:"Verify",component:ct}),(0,b.jsx)(Nt.Screen,{name:"ProcessForm",component:it})]})})})};function _t(){return(0,d.useEffect)(()=>{!async function(){if(Ue.isDevice){const{status:e}=await Xe.getPermissionsAsync();let t=e;if("granted"!==e){const{status:e}=await Xe.requestPermissionsAsync();t=e}if("granted"!==t)alert("Failed to get push notification permissions!")}else alert("Must use physical device for Push Notifications")}()},[]),(0,b.jsx)(jt.SafeAreaProvider,{children:(0,b.jsx)(q.GestureHandlerRootView,{style:{flex:1},children:(0,b.jsx)(w,{children:(0,b.jsx)(P,{children:(0,b.jsx)(St,{})})})})})}},4082(e,t,a){e.exports=a.p+"static/media/logo.fb3d6f6707300388be5c.png"}},t={};function a(s){var r=t[s];if(void 0!==r)return r.exports;var l=t[s]={exports:{}};return e[s].call(l.exports,l,l.exports,a),l.exports}a.m=e,a.amdO={},(()=>{var e=[];a.O=(t,s,r,l)=>{if(!s){var n=1/0;for(d=0;d<e.length;d++){for(var[s,r,l]=e[d],o=!0,c=0;c<s.length;c++)(!1&l||n>=l)&&Object.keys(a.O).every(e=>a.O[e](s[c]))?s.splice(c--,1):(o=!1,l<n&&(n=l));if(o){e.splice(d--,1);var i=r();void 0!==i&&(t=i)}}return t}l=l||0;for(var d=e.length;d>0&&e[d-1][2]>l;d--)e[d]=e[d-1];e[d]=[s,r,l]}})(),a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var s in t)a.o(t,s)&&!a.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.p="/",(()=>{var e={792:0};a.O.j=t=>0===e[t];var t=(t,s)=>{var r,l,[n,o,c]=s,i=0;if(n.some(t=>0!==e[t])){for(r in o)a.o(o,r)&&(a.m[r]=o[r]);if(c)var d=c(a)}for(t&&t(s);i<n.length;i++)l=n[i],a.o(e,l)&&e[l]&&e[l][0](),e[l]=0;return a.O(d)},s=self.webpackChunkweb=self.webpackChunkweb||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})();var s=a.O(void 0,[203],()=>a(5871));s=a.O(s)})();
//# sourceMappingURL=main.87168e30.js.map